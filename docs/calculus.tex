\documentclass{article}

\usepackage{float}
\usepackage{amsmath}
\usepackage{amssymb}
\usepackage{dsfont}
\usepackage{prooftree}
\usepackage{amsthm, thmtools}
\usepackage{mathtools}
\usepackage{mdframed}

\theoremstyle{definition}
\newtheorem{theorem}{Theorem}
\newtheorem{lemma}{Lemma}
\declaretheorem[name=Definition,qed={\lower-0.3ex\hbox{$\blacksquare$}}]{definition}
\newtheorem{proposition}{Proposition}
\newtheorem{corollary}{Corollary}
\newtheorem{example}{Example}
\newtheorem{fact}{Fact}

\def\limp {\mathbin{{-}\mkern-3.5mu{\circ}}}

% Standard backward sequents
\newcommand{\bkwseq}[3]{#1 ; #2 \Longrightarrow #3}

% Standard forward sequents
\newcommand{\fwdseq}[3]{#1 ; #2 \longrightarrow #3}

% backward and forward neutral sequents symbols and macros
\newcommand{\bneuseqsymb}{
  \mathrel{\Longrightarrow\!\!\!\!\!\!\!\!\Longrightarrow}}
% \newcommand{\fneuseqsymb}{\twoheadrightarrow}
\newcommand{\fneuseqsymb}{
  \mathrel{\longrightarrow\!\!\!\!\!\!\!\!\longrightarrow}}
\newcommand{\bneuseq}[3]{#1 ; #2 \bneuseqsymb #3}
\newcommand{\fneuseq}[3]{#1 ; #2 \fneuseqsymb #3}

% backward derived-rule relations
\newcommand{\brfrel}[1]{\textsf{foc}^+_{\Uparrow}(#1)}
\newcommand{\blfrel}[1]{\textsf{foc}^-_{\Uparrow}(#1)}
\newcommand{\bactrel}[1]{\textsf{act}_{\Uparrow}(#1)}

% forward derived-rule relations
\newcommand{\frfrel}[1]{\textsf{foc}^+_{\Downarrow}(#1)}
\newcommand{\flfrel}[1]{\textsf{foc}^-_{\Downarrow}(#1)}
\newcommand{\factrel}[1]{\textsf{act}_{\Downarrow}(#1)}

% Relation judgement   rel[...] ~--> res
\newcommand{\relj}[3]{#1 [#2] \hookrightarrow #3}

% Relation + judgement
\newcommand{\brfrelj}[3]{\relj{\brfrel{#1}}{#2}{#3}}
\newcommand{\blfrelj}[3]{\relj{\blfrel{#1}}{#2}{#3}}
\newcommand{\bactrelj}[3]{\relj{\bactrel{#1}}{#2}{#3}}
\newcommand{\frfrelj}[3]{\relj{\frfrel{#1}}{#2}{#3}}
\newcommand{\flfrelj}[3]{\relj{\flfrel{#1}}{#2}{#3}}
\newcommand{\factrelj}[3]{\relj{\factrel{#1}}{#2}{#3}}

% Three-place bold sequents     G, D, O ===> C
\newcommand{\btriseq}[4]{#1; #2; #3 \Longrightarrow #4}

% Focusing sequents
\newcommand{\rfocseq}[3]{#1; #2 \gg #3}
\newcommand{\lfocseq}[4]{#1; #2; #3 \ll #4}

% Rule labels
\newcommand{\init}{\textsc{init}}
\newcommand{\rinit}{\textsc{rinit}}
\newcommand{\linit}{\textsc{linit}}
\newcommand{\lact}{\textsc{lact}}
\newcommand{\ract}{\textsc{ract}}
\newcommand{\bact}{\textsc{bact}}
\newcommand{\rfoc}{\textsc{rfoc}}
\newcommand{\lfoc}{\textsc{lfoc}}
\newcommand{\actrule}{\textsc{act}}
\newcommand{\matchrule}{\textsc{match}}
\newcommand{\matchprimerule}{\textsc{match'}}
\newcommand{\rightfocusrule}{\textsc{right-focus}}
\newcommand{\leftfocusrule}{\textsc{left-focus}}
\newcommand{\copyfocusrule}{\textsc{copy-focus}}
\newcommand{\rblur}{\textsc{rblur}}
\newcommand{\lblur}{\textsc{lblur}}
\newcommand{\rblurstar}{\textsc{rblur}^*}
\newcommand{\lblurstar}{\textsc{lblur}^*}
\newcommand{\faplus}{\textsc{FA}^+}
\newcommand{\faminus}{\textsc{FA}^-}
\newcommand{\faplusstar}{\textsc{FA}^{+*}}
\newcommand{\faminusstar}{\textsc{FA}^{-*}}
\newcommand{\copyrule}{\textsc{copy}}
\newcommand{\focplusrule}{\textsf{foc}^+_{\Downarrow}}
\newcommand{\focminusrule}{\textsf{foc}^-_{\Downarrow}}
\newcommand{\foccopyrule}{\textsf{!foc}^-_{\Downarrow}}

\newcommand{\ctrlset}[1]{\mathfrak{S}_{#1}}

\newcommand{\respects}[2]{#1 \, || \, #2}

\newcommand{\labels}[2]{#1 \, \# \, #2}

\newcommand{\strong}[1]{\textbf{#1}}

\newcommand{\subsequent}[2]{#1 \leq #2}
\newcommand{\frwdseq}[3]{#1 ; #2 \longrightarrow #3}

\newcommand{\tyj}[2]{#1 : #2}
\newcommand{\seqpt}[2]{#1 \, :: \, #2}

% Formula decoration
\newcommand{\decplus}[1]{#1^+}
\newcommand{\decminus}[1]{#1^-}
\newcommand{\declinear}[1]{#1_.}
\newcommand{\decunrestr}[1]{#1_!}
\newcommand{\decpluslinear}[1]{\decplus{\declinear{#1}}}
\newcommand{\decminuslinear}[1]{\decminus{\declinear{#1}}}
\newcommand{\decminusunrestr}[1]{\decminus{\decunrestr{#1}}}
\newcommand{\decplusminus}[1]{#1^{\pm}}
\newcommand{\decminusplus}[1]{#1^{\mp}}

% Derivation terms
\newcommand{\dtinit}[1]{\textsf{init}(#1)}
\newcommand{\dtcopy}[3]{\textsf{copy}(#1, \labels{#2}{#3})}
\newcommand{\dtotimesr}[4]{\otimes \textsf{R}(#1, #2 ; \labels{#3}{#4})}
\newcommand{\dtotimesl}[7]{\otimes
  \textsf{L}(#1, \labels{#2}{#3}, \labels{#4}{#5} ; \labels{#6}{#7})}
\newcommand{\dtlimpr}[5]{\limp \textsf{R}(#1, \labels{#2}{#3}
  ; \labels{#4}{#5})}
\newcommand{\dtlimpl}[6]{\limp \textsf{L}(#1, #2, \labels{#3}{#4} ; \labels{#5}{#6})}
\newcommand{\dtfactor}[5]{\textsf{factor}(#1 . #2 . #3 ; \tyj{#4}{#5})}

\title{A forward focused calculus for Zsyntax}
\author{Filippo Sestini}

\begin{document}

\maketitle
\tableofcontents

\section{Backward sequent calculus}

\subsection{Control sets}

\subsubsection{Annotation}

\begin{definition}
  An annotated sequent is syntactically represented as $\Gamma; \Delta
  \Longrightarrow_{\ctrlset{}} C$, where $\Gamma, \Delta$ are the ordinary
  unrestricted and linear contexts, $C$ is the succedent formula and
  $\ctrlset{}$ is a control set.
\end{definition}

\begin{figure}[ht]
  \begin{mdframed}
    \[
      \begin{prooftree}
        \justifies
        \Gamma; P \Longrightarrow_{\emptyset} P
        \using{init}
      \end{prooftree}
      \qquad \qquad
      \begin{prooftree}
        \Gamma, A; \Delta, A \Longrightarrow_{\ctrlset{}} C
        \justifies
        \Gamma, A; \Delta \Longrightarrow_{\ctrlset{}} C
        \using{copy}
      \end{prooftree}
    \]

    \[
      \begin{prooftree}
        \Gamma; \Delta \Longrightarrow_{\ctrlset{1}} A
        \qquad
        \Gamma; \Delta' \Longrightarrow_{\ctrlset{2}} B
        \justifies
        \Gamma; \Delta, \Delta' \Longrightarrow_{\ctrlset{1}\cup \ctrlset{2}} A \otimes B
        \using{\otimes R}
      \end{prooftree}
      \qquad \qquad
      \begin{prooftree}
        \Gamma; \Delta, A, B \Longrightarrow_{\ctrlset{}} C
        \justifies
        \Gamma; \Delta, A \otimes B \Longrightarrow_{\ctrlset{}} C
        \using{\otimes L}
      \end{prooftree}
    \]

    \[
      \begin{prooftree}
        \Gamma; \Delta_1 \Longrightarrow_{\ctrlset{1}} A
        \qquad
        \Gamma; \Delta_2, B \Longrightarrow_{\ctrlset{2}} C
        \justifies
        \Gamma; \Delta_1, \Delta_2, A \limp B
        \Longrightarrow_{\ctrlset{1} \cup \ctrlset{2} \cup \ctrlset{A \rightarrow B}} C
      \end{prooftree}
      \qquad \qquad
      \begin{prooftree}
        \Gamma; \Delta, A \Longrightarrow_{\ctrlset{}} B
        \justifies
        \Gamma; \Delta \Longrightarrow_{\ctrlset{}} A \limp B
        \using{\limp R}
      \end{prooftree}
    \]
  \end{mdframed}
  \caption{\label{myfig} Annotated backward sequent calculus.}
\end{figure}



\subsubsection{Checking}

Consider the usual example of .... More precisely, we have
an axiom $E\otimes S \rightarrow E \odot S$,
with $\ctrlset{E\otimes S \rightarrow E \odot S} = \{I\}$, thus we expect
$E \otimes S\otimes I \limp E \odot S \otimes I$ to \emph{not} be valid in our
checked, annotated sequent calculus. The following is the annotated derivation,
where $\Gamma \equiv E\otimes S \rightarrow E \odot S$:

\[
  \begin{prooftree}
    \[
      \[
        \[ \justifies \Gamma; I \Longrightarrow_{\emptyset} I \using{\init} \]
        \qquad
        \[
          \[
            \[
              \[
                \justifies
                \Gamma; E \Longrightarrow_{\emptyset} E
                \using{\init}
              \]\qquad
              \[
                \justifies
                \Gamma; S \Longrightarrow_{\emptyset} S
                \using{\init}
              \]
              \justifies
              \Gamma; E , S \Longrightarrow_{\emptyset} E \otimes S
              \using{\otimes R}
            \]
            \qquad
            \[
              \justifies \Gamma; E\odot S \Longrightarrow_{\emptyset} E \odot S
              \using{\init}
            \]
            \justifies
            \Gamma; E\otimes S \limp E\odot S, E , S \Longrightarrow_{\{I\}} E \odot S
            \using{\limp L}
          \]
          \justifies
          \Gamma; E , S \Longrightarrow_{\{I\}} E \odot S
          \using{\copyrule}
        \]
        \justifies
        \Gamma; E , S , I \Longrightarrow_{\{I\}} E \odot S \otimes I
        \using{\otimes R}
      \]
      \justifies
      \Gamma; E \otimes S \otimes I \Longrightarrow_{\{I\}}  E \odot S \otimes I
      \using{\otimes L \times 3}
    \]
    \justifies
    \Gamma; \cdot \Longrightarrow_{\{I\}} E \otimes S \otimes I \limp E \odot S \otimes
   I
   \using{\limp R}
  \end{prooftree}
\]

Therefore, if we ignore the constraints of the control sets, the formula is
actually derivable (since it is a theorem in Linear Logic). A first attempt to
block this may be to impose a side condition to the applicability of the rule
$\otimes R$, restricting it to conclusion sequents in which the context respects
the control sets of both premises:


\[
  \begin{prooftree}
    \Gamma; \Delta_1 \Longrightarrow_{\ctrlset{1}} A
    \qquad
    \Gamma; \Delta_2 \Longrightarrow_{\ctrlset{2}} B
    \justifies
    \Gamma; \Delta_1, \Delta_2 \Longrightarrow_{\ctrlset{1} \cup \ctrlset{2}} A
    \otimes B
  \end{prooftree}
  \quad
  \respects{(\Gamma, \Delta_1, \Delta_2)}{(\ctrlset{1} \cup \ctrlset{2})}
\]

a similar addition can be done to $\limp L$, for the same reason:

\[
  \begin{prooftree}
    \Gamma; \Delta_1 \Longrightarrow_{\ctrlset{1}} A
    \qquad
    \Gamma; \Delta_2, B \Longrightarrow_{\ctrlset{2}} C
    \justifies
    \Gamma; \Delta_1, \Delta_2, A \limp B
    \Longrightarrow_{\ctrlset{1} \cup \ctrlset{2} \cup \ctrlset{A \rightarrow B}} C
  \end{prooftree}
  \quad
  \respects{(\Gamma, \Delta_1, \Delta_2)}{(\ctrlset{1} \cup \ctrlset{2})}
\]

It is immediate to notice that, with these new side conditions, the formula
above is no longer derivable. This modification, however, turns out to be too
restrictive. Suppose we have $\ctrlset{A \rightarrow B} = \{I\}$. The following
is valid in Zsyntax:

\[
  I \rightarrow A, A \rightarrow B, I, A \models A \otimes B
\]

since we have the following derivation:

\[
  \begin{prooftree}
    \[
      \[
        I \rightarrow A, A \rightarrow B, I, A
        \justifies
        A, A, A \rightarrow B
        \using{\rightarrow \mathcal{E}}
      \]
      \justifies
      A, B
      \using{\rightarrow \mathcal{E}}
    \]
    \justifies
    A \otimes B
    \using{\otimes \mathcal{I}}
  \end{prooftree}
\]

Notice that here we are indeed allowed to eliminate $A \rightarrow B$, because
the inhibitor $I$ which may have blocked the reaction has already been
eliminated in a previous stage of the deduction/reaction. An easy check can
verify that, with the side conditions above, the sequent
$\Gamma; \cdot \Longrightarrow I \otimes A \limp A \otimes B$, where $\Gamma$
contains the axioms as usual, cannot be derived.

The reason is that the side conditions, formulated as above, cannot capture the
temporal differences in the reactions. In this example, the reaction starts with
$I$, which is indeed an inhibitor for $A \rightarrow B$, but since the reaction
between $A \rightarrow B$ and $A$ happens at a later stage, when $I$ has
disappeared from the \emph{current state}, its presence in the control set of $A
\rightarrow B$ causes no problem.

In order to generalize this, consider the premises of $\limp L$, that is,
$\Gamma; \Delta_1 \Longrightarrow_{\ctrlset{1}} A$ and
$\Gamma; \Delta_2, B \Longrightarrow_{\ctrlset{2}} C$. These may be interpreted
as having two deductions

\[
  \begin{prooftree}
    A_1, \dots A_n, \Delta_1
    \leadsto
    A
  \end{prooftree}
  \qquad
  \begin{prooftree}
    A_{n+1}, \dots A_{n+m}, \Delta_2, B
    \leadsto
    C
  \end{prooftree}
\]

where $\forall i \in \{1,\dots,n+m\}, A_i \in \Gamma$, and that result from
rules that can be applied under a control set respectively $\ctrlset{1}$ and
$\ctrlset{2}$.  Suppose now that we start from a Z-state
$A_1, \dots A_n, \Delta_1, A_{n+1}, \dots A_{n+m}, \Delta_2, A\rightarrow B$. It
is understood that we can reproduce the first deduction to get

\[
  \begin{prooftree}
    A_1, \dots A_n, \Delta_1, A_{n+1}, \dots A_{n+m}, \Delta_2, A \rightarrow B
    \leadsto
    A, A_{n+1}, \dots A_{n+m}, \Delta_2, B, A \rightarrow B
  \end{prooftree}
\]

as long as all formulas in $A_{n+1}, \dots A_{n+m}, \Delta_2, A \rightarrow B$
respect the constraints imposed by the control set $\ctrlset{1}$. Then, as long
as $A_{n+1}, \dots A_{n+m}, \Delta_2$ respect $\ctrlset{A\rightarrow B}$, we
can eliminate the implication

\[
  \begin{prooftree}
    \[
      A_1, \dots A_n, \Delta_1, A_{n+1}, \dots A_{n+m}, \Delta_2, A \rightarrow B
      \leadsto
      A, A_{n+1}, \dots A_{n+m}, \Delta_2, A \rightarrow B
    \]
    \justifies
    A_{n+1}, \dots A_{n+m}, \Delta_2, B
    \using{\rightarrow \mathcal{E}}
  \end{prooftree}
\]

now we can just reproduce the second derivation, to get


\[
  \begin{prooftree}
    \[
      \[
        A_1, \dots A_n, \Delta_1, A_{n+1}, \dots A_{n+m}, \Delta_2, A \rightarrow B
        \leadsto
        A, A_{n+1}, \dots A_{n+m}, \Delta_2, A \rightarrow B
      \]
      \justifies
      A_{n+1}, \dots A_{n+m}, \Delta_2, B
      \using{\rightarrow \mathcal{E}}
    \]
    \leadsto
    C
  \end{prooftree}
\]

We can relax the side conditions to allow for these kinds of deduction in the
sequent calculus, as follows:

\[
  \begin{prooftree}
    \Gamma; \Delta_1 \Longrightarrow_{\ctrlset{1}} A
    \qquad
    \Gamma; \Delta_2, B \Longrightarrow_{\ctrlset{2}} C
    \justifies
    \Gamma; \Delta_1, \Delta_2, A \limp B
    \Longrightarrow_{\ctrlset{1} \cup \ctrlset{2} \cup \ctrlset{A \rightarrow B}} C
  \end{prooftree}
  \quad \text{provided} \quad
  \begin{cases}
    \respects{(\Gamma, \Delta_2, A \rightarrow B)}{\ctrlset{1}} \\
    \respects{(\Gamma, \Delta_2)}{\ctrlset{A \rightarrow B}}
  \end{cases}
\]

A similar situation arises with the tensor product. Consider the premises of the
rule $\otimes R$, i.e.,
$\Gamma; \Delta_1 \Longrightarrow_{\ctrlset{1}} A$ and
$\Gamma; \Delta_2 \Longrightarrow_{\ctrlset{2}} B$. This means that we have

\[
  \begin{prooftree}
    A_1, \dots A_n, \Delta_1
    \leadsto
    A
  \end{prooftree}
  \qquad
  \begin{prooftree}
    A_{n+1}, \dots A_{n+m}, \Delta_2
    \leadsto
    B
  \end{prooftree}
\]

where $\forall i \in \{1,\dots,n+m\}, A_i \in \Gamma$, and that result from
rules that can be applied under a control set respectively $\ctrlset{1}$ and
$\ctrlset{2}$.  Suppose now that we start from a Z-state
$A_1, \dots A_n, \Delta_1, A_{n+1}, \dots A_{n+m}, \Delta_2$.  Then, if we view
the two deductions above as monolithic, we have essentially three different
ways to derive $A \otimes B$.

\begin{enumerate}
\item We may start by reproducing the first derivation, followed by the second:

  \[
    \begin{prooftree}
      \[
        \[
          A_1, \dots A_n, \Delta_1, A_{n+1}, \dots A_{n+m}, \Delta_2
          \leadsto
          A, A_{n+1}, \dots A_{n+m}, \Delta_2
        \]
        \leadsto
        A, B
      \]
      \justifies
      A \otimes B
    \end{prooftree}
  \]

  provided $A_{n+1}, \dots A_{n+m}, \Delta_2$ respects $\ctrlset{1}$ and
  $A$ respects $\ctrlset{2}$.
  
\item We may start by reproducing the second derivation, followed by the first:

  \[
    \begin{prooftree}
      \[
        \[
          A_1, \dots A_n, \Delta_1, A_{n+1}, \dots A_{n+m}, \Delta_2
          \leadsto
          A_1, \dots A_n, \Delta_1, B
        \]
        \leadsto
        A, B
      \]
      \justifies
      A \otimes B
    \end{prooftree}
  \]

  provided $A_1, \dots A_n, \Delta_1$ respects $\ctrlset{2}$ and
  $B$ respects $\ctrlset{1}$.

\item We may reproduce the two derivations in parallel, as allowed by Zsyntax:

  \[
    \begin{prooftree}
      \[
        A_1, \dots A_n, \Delta_1, A_{n+1}, \dots A_{n+m}, \Delta_2
        \leadsto
        A, B
      \]
      \justifies
      A \otimes B
    \end{prooftree}
  \]

  provided both $\Delta_1$ and $\Delta_2$ respect $\ctrlset{1} \cup \ctrlset{2}$.
\end{enumerate}

We can relax the side conditions to allow for these kinds of deduction in the
sequent calculus, as follows:

\[
  \begin{prooftree}
    \Gamma; \Delta_1 \Longrightarrow_{\ctrlset{1}} A
    \qquad
    \Gamma; \Delta_2 \Longrightarrow_{\ctrlset{2}} B
    \justifies
    \Gamma; \Delta_1, \Delta_2 \Longrightarrow_{\ctrlset{1} \cup \ctrlset{2}} A
    \otimes B
  \end{prooftree}\quad \text{provided} \quad
  \begin{cases}
    ((\Gamma, \Delta_2) || \ctrlset{1} \wedge (\Gamma, A) || \ctrlset{2}) \; \vee \\
    ((\Gamma, \Delta_1) || \ctrlset{2} \wedge (\Gamma, B) || \ctrlset{1}) \; \vee \\
    ((\Gamma, \Delta_1, \Delta_2) || \ctrlset{1} \cup \ctrlset{2})
  \end{cases}
\]

Notice that, with these modifications, it does not hold that if
$\Gamma; \Delta \Longrightarrow_{\ctrlset{}} C$ then
$\respects{(\Gamma, \Delta)}{\ctrlset{}}$.  Nevertheless, this has no influence
on the fact that we must do the union of the control sets of the premises in the
conclusion sequent. In fact, the control set annotation in a sequent tells us
what must be true externally, i.e., in a hypothetical additional context in
which we may want to make the reaction happen, whereas the check condition tells
us what must hold internally, i.e. in the starting context/state
$\Gamma, \Delta$ itself, in order for the sequent to represent a biologically
correct reaction. It follows that it makes sense for the check conditions to be
less restrictive that the ones we may think of (and that we described as our
first attempt), since they may take into account the order in which internal
reactions, represented by the premise sequents, take place. Instead, the control
set that annotates the conclusion sequent must account for all these conditions
regardless of the order in which they occur
internally. Figure~\ref{annotated-checked} shows the complete calculus with the
updated side conditions.

\begin{figure}[ht]
  \begin{mdframed}
    \[
      \begin{prooftree}
        \justifies
        \Gamma; P \Longrightarrow^c_{\emptyset} P
        \using{\init}
      \end{prooftree}
      \qquad \qquad
      \begin{prooftree}
        \Gamma, A; \Delta, A \Longrightarrow^c_{\ctrlset{}} C
        \justifies
        \Gamma, A; \Delta \Longrightarrow^c_{\ctrlset{}} C
        \using{\copyrule}
      \end{prooftree}
    \]

    \[
      \begin{prooftree}
        \Gamma; \Delta, A, B \Longrightarrow^c_{\ctrlset{}} C
        \justifies
        \Gamma; \Delta, A \otimes B \Longrightarrow^c_{\ctrlset{}} C
        \using{\otimes L}
      \end{prooftree}
      \qquad \qquad
      \begin{prooftree}
        \Gamma; \Delta, A \Longrightarrow^c_{\ctrlset{}} B
        \justifies
        \Gamma; \Delta \Longrightarrow^c_{\ctrlset{}} A \limp B
        \using{\limp R}
      \end{prooftree}
    \]

    \[
      \begin{prooftree}
        \Gamma; \Delta_1 \Longrightarrow_{\ctrlset{1}} A
        \qquad
        \Gamma; \Delta_2 \Longrightarrow_{\ctrlset{2}} B
        \justifies
        \Gamma; \Delta_1, \Delta_2 \Longrightarrow_{\ctrlset{1} \cup \ctrlset{2}} A
        \otimes B
        \using{\otimes R}
      \end{prooftree}\quad
      \begin{cases}
        ((\Gamma, \Delta_2) || \ctrlset{1} \wedge (\Gamma, A) || \ctrlset{2}) \; \vee \\
        ((\Gamma, \Delta_1) || \ctrlset{2} \wedge (\Gamma, B) || \ctrlset{1}) \; \vee \\
        ((\Gamma, \Delta_1, \Delta_2) || \ctrlset{1} \cup \ctrlset{2})
      \end{cases}
    \]
    
    \[
      \begin{prooftree}
        \Gamma; \Delta_1 \Longrightarrow_{\ctrlset{1}} A
        \qquad
        \Gamma; \Delta_2, B \Longrightarrow_{\ctrlset{2}} C
        \justifies
        \Gamma; \Delta_1, \Delta_2, A \limp B
        \Longrightarrow_{\ctrlset{1} \cup \ctrlset{2} \cup \ctrlset{A
            \rightarrow B}} C
        \using{\limp L}
      \end{prooftree}
      \quad
      \begin{cases}
        \respects{(\Gamma, \Delta_2, A \rightarrow B)}{\ctrlset{1}} \\
        \respects{(\Gamma, \Delta_2)}{\ctrlset{A \rightarrow B}}
      \end{cases}
    \]
    
  \end{mdframed}
  \caption{\label{annotated-checked} Annotated checked backward sequent calculus.}
\end{figure}

\begin{definition}
  We augment the notation $\Gamma \vdash \Delta$ w.r.t. theorems of Zsyntax with
  the notation $\Gamma \vdash_{\ctrlset{}} \Delta$ for a control set
  $\ctrlset{}$, to mean that it is possible to derive

  \[
    \begin{prooftree}
      \nabla, \Gamma
      \leadsto
      \nabla, \Delta
    \end{prooftree}
  \]

  for every $\nabla$ such that $\respects{\nabla}{\ctrlset{}}$.
\end{definition}

\begin{theorem}[Soundness]
  If $\Gamma; \Delta \Longrightarrow^c_{\ctrlset{}} C$, then
  $A_1, \dots, A_n, \Delta \vdash_{\ctrlset{}} C$ where $A_i \in \Gamma$ for
  all $i \in \{ 1, \dots, n\}$.
\end{theorem}
\begin{proof}
  By induction on the height of the derivation.

  \begin{enumerate}
  \item The last rule is $\init$. Then, the sequent is $\Gamma; P
    \Longrightarrow_{\emptyset} P$, and $P \models_{\emptyset} P$ by reflexivity
    of the $\models$ relation.

  \item The last rule is $\copyrule$. Then, by inductive hypothesis, there is a
    derivation $\mathcal{D}$ such that

    \[
      \begin{prooftree}
        A_1, \dots, A_n, \Delta, A
        \leadsto
        C
      \end{prooftree}
    \]

    where $A \in \Gamma$ and $A_i \in \Gamma$ for all $i \in \{ 1, \dots, n\}$.
    But then $\mathcal{D}$ satisfies the thesis.

  \item The last rule is $\otimes L$. Then, by inductive hypothesis, we have a
    derivation
    
    \[
      \begin{prooftree}
        A_1, \dots, A_n, \Delta, A, B
        \leadsto
        C
      \end{prooftree}
    \]

    where $A_i \in \Gamma$ for all $i \in \{ 1, \dots, n\}$.
    Then, by $\otimes \mathcal{E}$, we get

    \[
      \begin{prooftree}
        \[
          A_1, \dots, A_n, \Delta, A \otimes B
          \justifies
          A_1, \dots, A_n, \Delta, A, B
          \using{\otimes \mathcal{E}}
        \]
        \leadsto
        C
      \end{prooftree}
    \]
    
    since $\otimes \mathcal{E}$ does not introduce any additional constraints,
    we can conclude the thesis, i.e., $A_1, \dots, A_n, \Delta, A \otimes B
    \models_{\ctrlset{}} C$.

  \item The last rule is $\limp R$. Then, by inductive hypothesis, we have a
    derivation

    \[
      \begin{prooftree}
        A_1, \dots, A_n, \Delta, A
        \leadsto
        B
      \end{prooftree}
    \]

    where $A_i \in \Gamma$ for all $i \in \{ 1, \dots, n\}$.
    Then, by $\rightarrow \mathcal{I}$, we may deduce $A \rightarrow B$ from
    $A_1, \dots, A_n, \Delta$, without adding additional constraints to those of
    the above derivation. Hence, $A_1, \dots, A_n, \Delta \models_{\ctrlset{}} A
    \rightarrow B$.

  \item The last rule is $\otimes R$. Then, by inductive hypothesis

    
    \[
      \begin{prooftree}
        A_1, \dots, A_n, \Delta_1
        \leadsto
        A
      \end{prooftree}
      \qquad \qquad
      \begin{prooftree}
        A_{n+1}, \dots, A_{n+m}, \Delta_2
        \leadsto
        B
      \end{prooftree}
    \]

    where $A_i \in \Gamma$ for all $i \in \{ 1, \dots, n+m\}$.
    We now distinguish the three cases in which the check condition can be
    satisfied:

    \begin{enumerate}
    \item Case
      $\respects{\Gamma, \Delta_2}{\ctrlset{1}} \wedge \respects{\Gamma,
        A}{\ctrlset{2}}$. Then, we can derive

      \[
        \begin{prooftree}
          \[
            \[
              A_1, \dots, A_n, \Delta_1, A_{n+1}, \dots, A_{n+m}, \Delta_2
              \leadsto
              A, A_{n+1}, \dots, A_{n+m}, \Delta_2
            \]
            \leadsto
            A, B
          \]
          \justifies
          A \otimes B
        \end{prooftree}
      \]

      which holds for any additional context as long as it respects the control
      set involved in the two intermediate derivations, namely $\ctrlset{1},
      \ctrlset{2}$. Hence,
      $A_1, \dots, A_n, \Delta_1, A_{n+1}, \dots, A_{n+m},
      \Delta_2 \models_{\ctrlset{1} \cup \ctrlset{2}} A \otimes B$.
      
    \item Case
      $\respects{\Gamma, \Delta_1}{\ctrlset{2}} \wedge \respects{\Gamma,
        B}{\ctrlset{1}}$. Then, we can derive

      \[
        \begin{prooftree}
          \[
            \[
              A_1, \dots, A_n, \Delta_1, A_{n+1}, \dots, A_{n+m}, \Delta_2
              \leadsto
              A_1, \dots, A_n, \Delta_1, B
            \]
            \leadsto
            A, B
          \]
          \justifies
          A \otimes B
        \end{prooftree}
      \]

      As above, from this we may conclude

      \[
        A_1, \dots, A_n, \Delta_1, A_{n+1}, \dots, A_{n+m},
        \Delta_2 \vdash_{\ctrlset{1} \cup \ctrlset{2}} A \otimes B
      \]

    \item Case
      $\respects{(\Gamma, \Delta_1,
        \Delta_2)}{(\ctrlset{1}\cup\ctrlset{2})}$. Since Zsyntax allows for
      simultaneous application of inference rules, given the check condition we
      can derive

      \[
        \begin{prooftree}
          \[
            A_1, \dots, A_n, \Delta_1, A_{n+1}, \dots, A_{n+m}, \Delta_2
            \leadsto
            A, B
          \]
          \justifies
          A \otimes B
        \end{prooftree}
      \]
    \end{enumerate}
    
  \item The last rule is $\limp L$. Then, by inductive hypothesis, we have

        
    \[
      \begin{prooftree}
        A_1, \dots, A_n, \Delta_1
        \leadsto
        A
      \end{prooftree}
      \qquad \qquad
      \begin{prooftree}
        A_{n+1}, \dots, A_{n+m}, \Delta_2, B
        \leadsto
        C
      \end{prooftree}
    \]

    where $A_i \in \Gamma$ for all $i \in \{ 1, \dots, n+m\}$.
    By hypothesis the check condition is satisfied, hence
    $\respects{(\Gamma, \Delta_2, A \limp B)}{\ctrlset{1}}$ and
    $\respects{(\Gamma, \Delta_2)}{\ctrlset{A \rightarrow B}}$.
    Then, we may derive

    \[
      \begin{prooftree}
        \[
          \[
            A_1, \dots, A_n, \Delta_1, A_{n+1}, \dots, A_{n+m}, \Delta_2, A
            \rightarrow B
            \leadsto
            A_{n+1}, \dots, A_{n+m}, \Delta_2, A, A \rightarrow B
          \]
          \justifies
          A_{n+1}, \dots, A_{n+m}, \Delta_2, B
          \using{\rightarrow \mathcal{E}}
        \]
        \leadsto
        C
      \end{prooftree}
    \]
    
    which justifies the thesis

    \[
      A_1, \dots, A_n, \Delta_1, A_{n+1}, \dots, A_{n+m}, \Delta_2, A \rightarrow
      B \vdash_{\ctrlset{1}\cup\ctrlset{2}\cup\ctrlset{A \rightarrow B}} C
    \]
    
  \end{enumerate}
\end{proof}

\subsection{From natural deduction to sequent calculus}

...



We consider a very simple fragment of propositional intuitionistic
linear logic, which comprises the multiplicative connectives
$\otimes, \limp, \textbf{1}$, and the additive connective $\oplus$.

\[
  \begin{prooftree}
    \justifies
    \Gamma; P \Longrightarrow P
    \using{init}
  \end{prooftree}
  \qquad \qquad
  \begin{prooftree}
    \Gamma, A; \Delta, A \Longrightarrow C
    \justifies
    \Gamma, A; \Delta \Longrightarrow C
    \using{copy}
  \end{prooftree}
\]

\[
  \begin{prooftree}
    \Gamma; \Delta \Longrightarrow A
    \qquad
    \Gamma; \Delta' \Longrightarrow B
    \justifies
    \Gamma; \Delta, \Delta' \Longrightarrow A \otimes B
    \using{\otimes R}
  \end{prooftree}
  \qquad \qquad
  \begin{prooftree}
    \Gamma; \Delta, A, B \Longrightarrow C
    \justifies
    \Gamma; \Delta, A \otimes B \Longrightarrow C
    \using{\otimes L}
  \end{prooftree}
\]

% \[
%   \begin{prooftree}
%     \justifies
%     \Gamma; \cdot \Longrightarrow \textbf{1}
%     \using{\textbf{1} R}
%   \end{prooftree}
%   \qquad \qquad
%   \begin{prooftree}
%     \Gamma; \Delta \Longrightarrow C
%     \justifies
%     \Gamma; \Delta, \textbf{1} \Longrightarrow C
%     \using{\textbf{1} L}
%   \end{prooftree}
% \]

\[
  \begin{prooftree}
    \Gamma; \Delta \Longrightarrow A
    \qquad
    \Gamma; \Delta', B \Longrightarrow C
    \justifies
    \Gamma; \Delta, \Delta', A \limp B \Longrightarrow C
    \using{\limp L}
  \end{prooftree}
  \qquad \qquad
  \begin{prooftree}
    \Gamma; \Delta, A \Longrightarrow B
    \justifies
    \Gamma; \Delta \Longrightarrow A \limp B
    \using{\limp R}
  \end{prooftree}
\]


% \[
%   \begin{prooftree}
%     \Gamma; \Delta, A \Longrightarrow C
%     \qquad
%     \Gamma; \Delta, B \Longrightarrow C
%     \justifies
%     \Gamma; \Delta, A \oplus B \Longrightarrow C
%     \using{\oplus L}
%   \end{prooftree}
%   \qquad
%   \begin{prooftree}
%     \Gamma; \Delta \Longrightarrow A
%     \justifies
%     \Gamma; \Delta \Longrightarrow A \oplus B
%     \using{\oplus R 1}
%   \end{prooftree}
%   \qquad
%   \begin{prooftree}
%     \Gamma; \Delta \Longrightarrow B
%     \justifies
%     \Gamma; \Delta \Longrightarrow A \oplus B
%     \using{\oplus R 2}
%   \end{prooftree}
% \]

\subsection{Cut elimination}

We first show that restricting the identity axiom on atomic formulas
only is conservative:

\begin{theorem}
  The identity axiom $\Gamma; A \Longrightarrow A$, where $A$ is of
  arbitrary complexity, is admissible.
\end{theorem}
\begin{proof}
  TODO.
\end{proof}

\begin{theorem}[Linear cut elimination]
  If $\Gamma; \Delta \Longrightarrow A$ and $\Gamma; \Delta', A
  \Longrightarrow C$, then $\Gamma; \Delta, \Delta' \Longrightarrow C$.
\end{theorem}
\begin{proof}
  By nested induction on the height of the derivations of the
  premises, and the complexity of the cut formula. We can distinguish
  some cases:

  \begin{enumerate}
  \item One of the premises is an axiom. Then:

    \[
      \begin{prooftree}
        \[\justifies \Gamma; P \Longrightarrow P\] \qquad
        \[\mathcal{E}
        \leadsto
        \Gamma; P \Longrightarrow C \]
        \justifies
        \Gamma; P \Longrightarrow C
      \end{prooftree}
    \]

    then, just take $\mathcal{E}$. The second case is:

    \[
      \begin{prooftree}
        \[\mathcal{D} \leadsto \Gamma; \Delta \Longrightarrow P\]
        \qquad
        \[\justifies \Gamma; P \Longrightarrow P\]
        \justifies
        \Gamma; \Delta \Longrightarrow P
      \end{prooftree}
    \]

    then, just take $\mathcal{D}$.
    
  \item (Principal cuts) The cut formula is introduced by a right rule
    in the left premise, and eliminated by a left rule in the right
    premise... TODO.
  \item (Left-commutative cases) The cut formula is a side formula in
    the left premise. Then, the cut is just routinely moved to the
    premises of the last rule that has been used to derive the left
    premise, and the inductive hypothesis is applied since we act on
    derivations of strictly smaller height.

    \begin{enumerate}
    \item The last rule is $copy$:
      
      \[
        \begin{prooftree}
          \[
            \Gamma, A ; \Delta, A \Longrightarrow B
            \justifies
            \Gamma, A; \Delta \Longrightarrow B
            \using{copy}
          \] \qquad
          \Gamma, A; \Delta', B \Longrightarrow C
          \justifies
          \Gamma, A ; \Delta, \Delta' \Longrightarrow C
        \end{prooftree}
      \]

      Then,

      \[
        \begin{prooftree}
          \[
            \Gamma, A; \Delta, A \Longrightarrow B
            \qquad
            \Gamma, A; \Delta', B \Longrightarrow C
            \justifies
            \Gamma, A; \Delta, \Delta', A \Longrightarrow C
            \using{cut}
          \]
          \justifies
          \Gamma, A ; \Delta, \Delta' \Longrightarrow C
          \using{copy}
        \end{prooftree}
      \]

      
    \item The last rule was...
    \end{enumerate}
    
  \item (Right-commutative cases) The cut formula is a side formula in
    the right premise. Then, the cut is just routinely moved to the
    premises of the last rule that has been used to derive the right
    premise, and the inductive hypothesis is applied since we act on
    derivations of strictly smaller height.

    \begin{enumerate}
    \item The last rule is $copy$:

      \[
        \begin{prooftree}
          \Gamma, A ; \Delta \Longrightarrow C
          \qquad
          \[
            \Gamma, A; \Delta', C, A \Longrightarrow D
            \justifies
            \Gamma, A; \Delta', C \Longrightarrow D
            \using{copy}
          \]
          \justifies
          \Gamma, A; \Delta, \Delta' \Longrightarrow D
          \using{cut}
        \end{prooftree}
      \]

      then

      \[
        \begin{prooftree}
          \[
            \Gamma, A ; \Delta \Longrightarrow C
            \qquad
            \Gamma, A; \Delta', C, A \Longrightarrow D
            \justifies
            \Gamma, A; \Delta, \Delta', A \Longrightarrow D
            \using{cut}
          \]
          \justifies
          \Gamma, A; \Delta, \Delta' \Longrightarrow D
          \using{copy}
        \end{prooftree}
      \]
    \end{enumerate}
  \end{enumerate}
\end{proof}

\begin{theorem}[Persistent cut elimination]
  If $\Gamma; \cdot \Longrightarrow A$ and $\Gamma, A; \Delta
  \Longrightarrow C$, then $\Gamma; \Delta \Longrightarrow C$.
\end{theorem}
\begin{proof}
  By structural induction on the height of the derivations.
  \begin{enumerate}
  \item One of the premises is an initial sequent. Hence, the right
    premise is, and

    \[
      \begin{prooftree}
        \Gamma; \cdot \Longrightarrow A
        \qquad
        \[ \justifies \Gamma, A; P \Longrightarrow P\]
        \justifies
        \Gamma; P \Longrightarrow P
      \end{prooftree}
    \]
    
    but then also $\Gamma; P \Longrightarrow P$ is an identity axiom,
    and can be derived without cut.
    
  \item All other cases are treated as right-commutative cuts, except
    for the case where the last rule in the right premise is
    $copy$. In this case, the cut is

    \[
      \begin{prooftree}
        \Gamma; \cdot \Longrightarrow A
        \qquad
        \[
          \Gamma, A; \Delta, A \Longrightarrow C
          \justifies
          \Gamma, A ; \Delta \Longrightarrow C
          \using{copy}
        \]
        \justifies
        \Gamma; \Delta \Longrightarrow C
        \using{cut!}
      \end{prooftree}
    \]

    But then, by inductive hypothesis and admissibility of linear cut,
    we have

    \[
      \begin{prooftree}
        \Gamma; \cdot \Longrightarrow A
        \qquad
        \[
          \Gamma; \cdot \Longrightarrow A
          \qquad
          \Gamma, A; \Delta, A \Longrightarrow C
          \justifies
          \Gamma; \Delta, A \Longrightarrow C
          \using{cut!}
        \]
        \justifies
        \Gamma; \Delta \Longrightarrow C
        \using{cut}
      \end{prooftree}
    \]

  \end{enumerate}
\end{proof}

\section{The Inverse Method}

\subsection{Multiplicative non-determinism}

... TODO. .... rationale for a forward calulus...

... TODO ... description of the inverse method...


.... blah blah we need a forward calculus .... blah...

\subsection{Forward sequent calculus}

Since weakening and contraction are admissible for the unrestricted
zone, we can treat $\Gamma$ as a set.

\begin{figure}[ht]
  \begin{mdframed}
    \[
      \begin{prooftree}
        \justifies
        \cdot ; P \longrightarrow P
        \using{\init}
      \end{prooftree}
      \qquad \qquad
      \begin{prooftree}
        \Gamma; \Delta, A \longrightarrow C
        \justifies
        \Gamma \cup \{A\}; \Delta \longrightarrow C
        \using{\copyrule}
      \end{prooftree}
    \]

    \[
      \begin{prooftree}
        \Gamma; \Delta \longrightarrow A
        \qquad
        \Gamma'; \Delta' \longrightarrow B
        \justifies
        \Gamma\cup \Gamma'; \Delta, \Delta' \longrightarrow A \otimes B
        \using{\otimes R}
      \end{prooftree}
      \qquad \qquad
      \begin{prooftree}
        \Gamma; \Delta, A, B \longrightarrow C
        \justifies
        \Gamma; \Delta, A \otimes B \longrightarrow C
        \using{\otimes L}
      \end{prooftree}
    \]

    \[
      \begin{prooftree}
        \Gamma; \Delta \longrightarrow A
        \qquad
        \Gamma'; \Delta', B \longrightarrow C
        \justifies
        \Gamma \cup \Gamma'; \Delta, \Delta', A \limp B \longrightarrow C
        \using{\limp L}
      \end{prooftree}
      \qquad \qquad
      \begin{prooftree}
        \Gamma; \Delta, A \longrightarrow B
        \justifies
        \Gamma; \Delta \longrightarrow A \limp B
        \using{\limp R}
      \end{prooftree}
    \]
  \end{mdframed}
  \caption{Forward sequent calculus}
\end{figure}

\begin{theorem}[Soundness]
  If $\Gamma ; \Delta \longrightarrow C$, then
  $\Gamma ; \Delta \Longrightarrow C$.
\end{theorem}
\begin{proof}
  Just notice that every forward derivation is also a backward derivation, with
  the difference that in the latter unrestricted contexts are copied in all
  the premises. The details are a straightforward induction on the height of a
  forward derivation, plus weakening for the backward calculus.
\end{proof}

\begin{theorem}[Completeness]
  If $\Gamma ; \Delta \Longrightarrow C$, then
  $\Gamma' ; \Delta \longrightarrow C$ for some $\Gamma' \subseteq \Gamma$.
\end{theorem}
\begin{proof}
  Straightforward induction on the backward derivation.
\end{proof}

\begin{example}
  The following is an example derivation of

  $$\frwdseq{R_1, R_3}{\cdot}{q \otimes n \limp d \otimes d \otimes d}$$

  where $R_1 \equiv n \otimes n \limp d$ and
  $R_3 \equiv q \limp d \otimes d \otimes n$.

  \[
    \begin{prooftree}
      \[
        \[
          \[
            \frwdseq{\cdot}{q}{q}
            \[
              \[
                \[
                  \frwdseq{}{d}{d}
                  \quad
                  \frwdseq{}{d}{d}
                  \justifies
                  \frwdseq{}{d, d}{d \otimes d}
                \]
                \quad
                \[
                  \[
                    \frwdseq{}{d}{d}
                    \quad
                    \[
                      \frwdseq{}{n}{n}
                      \quad
                      \frwdseq{}{n}{n}
                      \justifies
                      \frwdseq{}{n, n}{n \otimes n}
                    \]
                    \justifies
                    \frwdseq{}{n, n, n \otimes n \limp d}{d}
                  \]
                  \justifies
                  \frwdseq{R_1}{n, n}{d}
                \]
                \justifies
                \frwdseq{R_1}{n, d, d, n}{d \otimes d \otimes d}
              \]
              \justifies
              \frwdseq{R_1}{n, d \otimes d \otimes n}{d \otimes d \otimes d}
            \]
            \justifies
            \frwdseq{R_1}{q, n, q \limp d \otimes d \otimes n}{d \otimes d \otimes d}
          \]
          \justifies
          \frwdseq{R_1, R_3}{q, n}{d \otimes d \otimes d}
        \]
        \justifies
        \frwdseq{R_1, R_3}{q \otimes n}{d \otimes d \otimes d}
      \]
      \justifies
      \frwdseq{R_1, R_3}{\cdot}{q \otimes n \limp d \otimes d \otimes d}
    \end{prooftree}
  \]
\end{example}

...

\subsection{Subformula property}

The key technical property that makes the inverse method possible is the
\emph{subformula property}. Logical calculi with the subformula property are
such that derivations only contain subformulas of the conclusion formula. This
property means, in our case, that we only need to consider sequents composed of
subformulas of the goal sequent when searching for a cut-free proof.

We show that such property holds for our calculi by formalizing the idea in
terms of a \emph{subformula relation} for propositions. To do so, we decorate
subformulas with certain marks:

\begin{itemize}
\item \emph{Polarity}, written as a superscript + or - symbol;
\item \emph{Availability}, written as a superscript ! (for ``unrestricted'') or
  . (``linear''). Subformulas of an unrestricted formula \emph{do not} inherit
  the decoration.
\end{itemize}

The availability signs determine whether the formula is allowed to occur in the
unrestricted context, and thus serve as a guide for the copy rule.

\begin{definition}
  A decorated sequent is of the form $\Gamma^-_! ; \Delta^-_. \Longrightarrow
  C^+_.$ .
\end{definition}

\begin{definition}[Decorated subformula relation]
  The decorated subformula relation $\leq$ between decorated propositions is the
  reflexive-transitive closure of the following cases:

  \begin{alignat*}{2}
    & A^{\pm}_{.} \leq (A \otimes B)_a^{\pm} \qquad & B^{\pm}_{.} \leq (A \otimes
    B)_a^{\pm} \\
    & A^{\mp}_{.} \leq (A \limp B)_a^{\pm} & B^{\pm}_{.} \leq (A \limp
    B)_a^{\pm}
  \end{alignat*}
  \[
    A^{\pm}_{.} \leq A^{\pm}_{!}
  \]
\end{definition}

We assume the standard pointwise extension of this relation to sets of decorated
propositions:

\[
  S \leq T \equiv \forall A \in S, \exists B \in T : A \leq B
\]

\begin{definition}
  A decorated sequent $s_1 \equiv \Gamma^-_! ; \Delta^-_. \Longrightarrow C^+_.$
  is a subsequent of the decorated sequent
  $\Gamma'^-_! ; \Delta'^-_. \Longrightarrow C'^+_.$, written $s_1 \leq s_2$ if

  \[
    \subsequent{\Gamma'^-_! \cup \Delta'^-_. \cup C'^+_.}
    {\Gamma^-_! \cup \Delta^-_. \cup C^+_.}
  \]
\end{definition}

\begin{theorem}[Subformula property]
  If $\Gamma'; \Delta' \Longrightarrow C'$ appears in a proof of
  $\Gamma; \Delta \Longrightarrow C$, then

  \[
    \subsequent{\Gamma'; \Delta' \Longrightarrow C'}
    {\Gamma; \Delta \Longrightarrow C}
  \]
\end{theorem}
\begin{proof}
  By straightforward inspection of the rules of the backward calculus. It
  sufficies to observe that, if the following is such a rule:

  \[
    \begin{prooftree}
      s_1 \quad s_2 \quad \dots \quad s_n
      \justifies
      s
    \end{prooftree}
  \]

  then $s_i \leq s$ for all $i \in \{1, \dots, n\}$. The thesis follows by
  transitivity of the subformula relation.
\end{proof}

The same reasoning holds for the forward calculus, where the subsequent relation
is extended to forward sequents in the obvious way.

\begin{corollary}
  If $\Gamma'; \Delta' \longrightarrow C'$ appears in a proof of
  $\Gamma; \Delta \longrightarrow C$, then

  \[
    \subsequent{
      \Gamma'; \Delta' \longrightarrow C'
    }{
      \Gamma; \Delta \longrightarrow C
    }
  \]
\end{corollary}
\begin{proof}
  Immediate.
\end{proof}


\section{Focused derivations}

A backward focused proof has two phases. In the active phase all possible rules
are applied in an arbitrary order to asynchronous propositions. When only
synchronous propositions remain, one proposition is selected and a \emph{focused
  phase} for that proposition begins.

As out backward linear sequent calculus is two-sided, we have left- and right-
synchronous and asynchronous connectives.

\begin{table}[h]
  \centering
  \begin{tabular}{|l|l|}
    \hline
    \textbf{symbol} & \textbf{meaning} \\
    \hline
    $P$ & left-synchronous ($\limp$) \\
    $Q$ & right-synchronous ($\otimes$) \\
    $L$ & left-asynchronous ($\otimes$) \\
    $R$ & right-asynchronous ($\limp$) \\
    \hline
  \end{tabular}
\end{table}

The above table does not include the atomic propositions. For reasons explained
in [thesis], here we are forced to treat them as synchronous. However, we can
differenciate the atoms by means of a \emph{focusing bias}, which indicates
whether the atomic proposition under focus must immediately be derived in an
initial sequent.

The backward focusing calculus consists of the following kinds of sequents:

\begin{table}[h]
  \centering
  \begin{tabular}{|l|l|}
    \hline
    \textbf{symbol} & \textbf{meaning} \\
    \hline
    $\Gamma; \Delta \gg A$ & right-focal sequent with $A$ under focus \\
    $\Gamma; \Delta; A \ll Q$ & left-focal sequent with $A$ under focus \\
    $\Gamma; \Delta; \Omega \Longrightarrow C; \cdot$ & right-active sequent \\
    $\Gamma; \Delta; \Omega \Longrightarrow \cdot; Q$ & left-active sequent \\
    \hline
  \end{tabular}
\end{table}

Here, $\Delta$ contains only left-synchronous propositions, i.e., it is of the
form $P_1, \dots, P_n$. $\Omega$ is an ordered context of propositions which may
be synchronous of asynchronous.

For active sequents the right active propositions are decomposed until they
become right-synchronous, i.e. the sequent is of the form $\Gamma; \Delta;
\Omega \Longrightarrow Q; \cdot$. The right hand side is then changed to $\cdot;
Q$. Similarly, the propositions in $\Omega$ are decomposed except when the
proposition is left-synchronous, in which case it is transferred to $\Delta$.

Eventually, the active sequent is reduced to the form $\Gamma; \Delta; \cdot
\Longrightarrow \cdot \cdot; Q$, which we call \emph{neutral sequents}.
A focusing phase is launched from such a neutral sequent by selecting a
\emph{focusable} proposition and giving it the corresponsing focus.

\begin{definition}[Focusable proposition]
  \begin{enumerate}
  \item A proposition is right-focusable if it is right-synchronous and not a
    right-biased atom;
  \item A proposition is left-focusable if it is left-sunchronous and not a
    left-biased atom.
  \end{enumerate}
\end{definition}

When we are in a neutral sequent, we may copy a proposition out of the
unrestricted context and immediately focus on it, regardless of whether it is
focusable or not. If this proposition is actually left-asynchronous, then we
will immediately remove focus on it and transition to an active phase.

There are two forms of the initial sequent, corresponding to the two focusing
biases. If the focal proposition becomes atomic, we terminate with one of the
two initial forms. If the focal proposition is asynchronous, we blur the focus.
If the focal proposition is atomic and of the wrong bias, then also we blur the
focus, but in this case we transition directly to the neutral sequent instead of
entering the active phase.

Decomposing focal propositions uses non-invertible rules for that proposition,
and focus is maintained to the operands of the top-level connective of the
proposition.


\[
  \begin{prooftree}
    p \; \text{left-biased}
    \justifies
    \Gamma; p \gg p
    \using{rinit}
  \end{prooftree}
  \qquad \qquad
  \begin{prooftree}
    p \; \text{right-biased}
    \justifies
    \Gamma; \cdot; p \ll p
    \using{linit}
  \end{prooftree}
\]

\[
  \begin{prooftree}
    \Gamma; \Delta; \Omega \Longrightarrow \cdot; Q
    \justifies
    \Gamma; \Delta; \Omega \Longrightarrow Q; \cdot
    \using{ract}
  \end{prooftree}
  \qquad \qquad
  \begin{prooftree}
    \Gamma; \Delta, P; \Omega \cdot \Omega' \Longrightarrow \gamma
    \justifies
    \Gamma; \Delta; \Omega \cdot P \cdot \Omega' \Longrightarrow \gamma
    \using{lact}
  \end{prooftree}
\]

\[
  \begin{prooftree}
    \Gamma; \Delta \gg Q \qquad Q\; \text{right-focusable}
    \justifies
    \Gamma; \Delta; \cdot \Longrightarrow \cdot ; Q
    \using{rfoc}
  \end{prooftree}
  \qquad \qquad
  \begin{prooftree}
    \Gamma; \Delta; P \ll Q \qquad P\; \text{left-focusable}
    \justifies
    \Gamma; \Delta, P; \cdot \Longrightarrow \cdot; Q
    \using{lfoc}
  \end{prooftree}
\]

\[
  \begin{prooftree}
    \Gamma; \Delta; \cdot \Longrightarrow R; \cdot
    \justifies
    \Gamma; \Delta \gg R
    \using{rblur}
  \end{prooftree}
  \qquad \qquad
  \begin{prooftree}
    \Gamma; \Delta; L \Longrightarrow \cdot; Q
    \justifies
    \Gamma; \Delta; L \ll Q
    \using{lblur}
  \end{prooftree}
\]

\[
  \begin{prooftree}
    \Gamma; \Delta; \cdot \Longrightarrow \cdot ; p \qquad p \; \text{right-biased}
    \justifies
    \Gamma; \Delta \gg p
    \using{rblur^*}
  \end{prooftree}
  \qquad \qquad
  \begin{prooftree}
    \Gamma; \Delta, p; \cdot \Longrightarrow \cdot; Q \qquad p \; \text{left-biased}
    \justifies
    \Gamma; \Delta; p \ll Q
    \using{lblur^*}
  \end{prooftree}
\]

\[
  \begin{prooftree}
    \Gamma, A; \Delta ; A \ll Q
    \justifies
    \Gamma, A; \Delta; \cdot \Longrightarrow \cdot; Q
    \using{copy}
  \end{prooftree}
\]

\[
  \begin{prooftree}
    \Gamma; \Delta; \Omega \cdot A \cdot B \cdot \Omega' \Longrightarrow \gamma
    \justifies
    \Gamma; \Delta; \Omega \cdot A \otimes B \cdot \Omega' \Longrightarrow
    \gamma
    \using{\otimes L}
  \end{prooftree}
  \qquad \qquad
  \begin{prooftree}
    \Gamma; \Delta_1 \gg A \qquad \Gamma; \Delta_2 \gg B
    \justifies
    \Gamma; \Delta_1, \Delta_2 \gg A \otimes B
    \using{\otimes R}
  \end{prooftree}
\]

\[
  \begin{prooftree}
    \Gamma; \Delta_1; B \ll Q \qquad \Gamma; \Delta_2 \gg A
    \justifies
    \Gamma; \Delta_1, \Delta_2 ; A \limp B \ll Q
    \using{\limp L}
  \end{prooftree}
  \qquad \qquad
  \begin{prooftree}
    \Gamma; \Delta; \Omega \cdot A \Longrightarrow B; \cdot
    \justifies
    \Gamma; \Delta; \Omega \Longrightarrow A \limp B; \cdot
    \using{\limp R}
  \end{prooftree}
\]

\begin{theorem}[Soundness]
  \begin{enumerate}
  \item If $\rfocseq{\Gamma}{\Delta}{A}$, then $\Gamma; \Delta \Longrightarrow
    A$;
  \item If $\lfocseq{\Gamma}{\Delta}{A}{Q}$, then $\Gamma ; \Delta, A
    \Longrightarrow Q$;
  \item If $\btriseq{\Gamma}{\Delta}{\Omega}{C ; \cdot}$, then $\Gamma; \Delta,
    \Omega \Longrightarrow C$;
  \item If $\btriseq{\Gamma}{\Delta}{\Omega}{\cdot ; C}$, then $\Gamma; \Delta,
    \Omega \Longrightarrow C$.
  \end{enumerate}
\end{theorem}
\begin{proof}
  The four assertions are proved simultaneously by straightforward induction on
  the height of the derivation.
\end{proof}

\begin{theorem}[Completeness]
  If $\Gamma ; \Delta \Longrightarrow C$, then
  $\Gamma; \cdot ; \Omega \Longrightarrow C ; \cdot$, where $\Omega$ is some
  listing of $\Delta$.
\end{theorem}
\begin{proof}
  This proof is much more involved than the one for soundness, and can be found
  in [thesis] for the full intuitionistic linear logic. It can be easily adapted
  to our small fragment since it does not rely on the presence of all
  connectives.
\end{proof}

\subsection{Backward derived rules}

The primary benefit of focusing is the ability to generate derived ``big step''
inference rules: the intermediate results of a focusing or active phase are not
important, since those steps are ``forced'' in some way. Each derived rule
starts (at the bottom) with a neutral sequent from which a synchronous
proposition is selected for focus, and the focusing steps are followed. Then the
active rules are applied, and eventually we obtain a collection of neutral
sequents as the leaves. These neutral sequents are then treated as the premises
of the derived rule that produces the neutral sequent with which we started.

We first construct the backward derived rules. Then we will move to their
forward version. The general design is that intermediate sequents in the eager
active and focusing phases are not be stored in any sequent database; instead,
all sequents constructed during search are neutral sequents at the phase
boundaries. This is achieved by first precomputing the derived rules that
correspond to the frontier literals of the goal sequent.

For any given proposition, we are interested in constructing a derived inference
for the proposition corresponding to a single pair of focusing and inverse
phases. The idea is to interpret a proposition itself as the derived rules that
it embodies. Every propostiion is viewed as a relation between the conclusion of
the rule and its premises at the leaves of the bipole. Both the conclusion and
the premises are neutral sequents, which we indicate as
$\bneuseq{\Gamma}{\Delta}{Q}$.

There are three classes of relational interpretations:

\begin{enumerate}
\item Right focal relations for the focus formula $A$, written $\brfrel{A}$;
\item Left focal relations for the focus formula $A$, written $\blfrel{A}$;
\item Active relations, written
  $\bactrel{\btriseq{\Gamma}{\Delta}{\Omega}{\xi}}$, where $\xi$ is either
  $\cdot$ or a proposition $C$.
\end{enumerate}

The full set of relations is given in Figure~\ref{fig:bkwdrelations}. Each
relation $R$ takes as input the conclusion sequent $s$, and produces a sequence
of premise sequents $\Sigma = s_1, \dots, s_n$; we write this as
$\relj{R}{s}{\Sigma}$. We use these relations to form a calculus of derived
rules which acts on neutral sequents only, as given in
Figure~\ref{fig:bkwdderivedcalculus}.

\begin{figure}[ht]
  \begin{mdframed}
    \[
      \begin{prooftree}
        p \; \text{right-biased}
        \justifies
        \relj{\blfrel{p}}{\bneuseq{\Gamma}{\cdot}{p}}{\cdot}
        \using{\linit}
      \end{prooftree}\qquad\qquad
      \begin{prooftree}
        p \; \text{left-biased}
        \justifies
        \relj{\brfrel{p}}{\bneuseq{\Gamma}{p}{\cdot}}{\cdot}
        \using{\rinit}
      \end{prooftree}
    \]

    \[
      \begin{prooftree}
        \relj{\brfrel{A}}{\bneuseq{\Gamma}{\Delta_1}{\cdot}}{\Sigma_1}
        \qquad
        \relj{\brfrel{B}}{\bneuseq{\Gamma}{\Delta_2}{\cdot}}{\Sigma_2}
        \justifies
        \relj{\brfrel{A \otimes B}}{\bneuseq{\Gamma}{\Delta_1,
            \Delta_2}{\cdot}}{\Sigma_1 \cdot \Sigma_2}
        \using{\otimes F}
      \end{prooftree}
    \]

    \[
      \begin{prooftree}
        \relj{\bactrel{\btriseq{\cdot}{\cdot}{\cdot}{R}}}{s}{\Sigma}
        \justifies
        \relj{\brfrel{R}}{s}{\Sigma}
        \using{\faplus}
      \end{prooftree}
      \qquad
      \begin{prooftree}
        p \; \text{right-biased}
        \justifies
        \relj{\brfrel{p}}{\bneuseq{\Gamma}{\Delta}{\cdot}}{\bneuseq{\Gamma}{\Delta}{p}}
        \using{conj^+}
      \end{prooftree}
    \]

    \[
      \begin{prooftree}
        \relj{\blfrel{B}}{\bneuseq{\Gamma}{\Delta_1}{Q}}{\Sigma_1} \qquad
        \relj{\brfrel{A}}{\bneuseq{\Gamma}{\Delta_2}{\cdot}}{\Sigma_2}
        \justifies
        \relj{\blfrel{A \limp B}}{\bneuseq{\Gamma}{\Delta_1,\Delta_2}{Q}}{\Sigma_1
          \cdot \Sigma_2}
        \using{\limp F}
      \end{prooftree}
    \]

    \[
      \begin{prooftree}
        \relj{\bactrel{\btriseq{\cdot}{\cdot}{L}{\cdot}}}{s}{\Sigma}
        \justifies
        \relj{\blfrel{L}}{s}{\Sigma}
        \using{FA^-}
      \end{prooftree}
      \qquad
      \begin{prooftree}
        p \; \text{left-biased}
        \justifies
        \relj{\blfrel{p}}{\bneuseq{\Gamma}{\Delta}{Q}}{\bneuseq{\Gamma}{\Delta, p}{Q}}
        \using{conj^-}
      \end{prooftree}
    \]

    \[
      \begin{prooftree}
        \relj{\bactrel{\btriseq{\Gamma}{\Delta}{\Omega \cdot A \cdot B \cdot
              \Omega'}{\xi}}}{s}{\Sigma}
        \justifies
        \relj{\bactrel{\btriseq{\Gamma}{\Delta}{\Omega \cdot A \otimes B \cdot
              \Omega'}{\xi}}}{s}{\Sigma}
        \using{\otimes A}
      \end{prooftree}
    \]
    \[
      \begin{prooftree}
        \relj{\bactrel{\btriseq{\Gamma}{\Delta}{\Omega \cdot A \cdot
              \Omega'}{B}}}{s}{\Sigma}
        \justifies
        \relj{\bactrel{\btriseq{\Gamma}{\Delta}{\Omega \cdot
              \Omega'}{A \limp B}}}{s}{\Sigma}
        \using{\limp A}
      \end{prooftree}
    \]

    \[
      \begin{prooftree}
        \relj{
          \bactrel{
            \btriseq{\Gamma}{\Delta,P}{\Omega \cdot \Omega'}{\xi}
          }
        }{s}{\Sigma}
        \justifies
        \relj{\bactrel{\btriseq{\Gamma}{\Delta}{\Omega \cdot P \cdot
              \Omega'}{\xi}}}{s}{\Sigma}
        \using{bact}
      \end{prooftree}
    \]

    \[
      \begin{prooftree}
        \justifies
        \relj{
          \bactrel{\btriseq{\Gamma}{\Delta}{\cdot}{\cdot}}
        }{
          \bneuseq{\Gamma'}{\Delta'}{Q}
        }{
          \bneuseq{\Gamma, \Gamma'}{\Delta, \Delta'}{Q}
        }
        \using{match}
      \end{prooftree}
    \]

    \[
      \begin{prooftree}
        \justifies
        \relj{
          \bactrel{\btriseq{\Gamma}{\Delta}{\cdot}{Q}}
        }{
          \bneuseq{\Gamma'}{\Delta'}{\cdot}
        }{
          \bneuseq{\Gamma, \Gamma'}{\Delta, \Delta'}{Q}
        }
        \using{match'}
      \end{prooftree}
    \]
  \end{mdframed}
  \caption{Backward relations for derived rules}
  \label{fig:bkwdrelations}
\end{figure}

\begin{figure}[ht]
  \begin{mdframed}
    \[
      \begin{prooftree}
        (\relj{\brfrel{Q}}{\bneuseq{\Gamma}{\Delta}{\cdot}}{s_1 \cdot s_2 \dots s_n})
        \quad s_1 \quad s_2 \quad \dots \quad s_n
        \justifies
        \bneuseq{\Gamma}{\Delta}{Q}
        \using{right-focus}
      \end{prooftree}
    \]

    \[
      \begin{prooftree}
        (\relj{\blfrel{Q}}{\bneuseq{\Gamma}{\Delta}{Q}}{s_1 \cdot s_2 \dots s_n})
        \quad s_1 \quad s_2 \quad \dots \quad s_n
        \justifies
        \bneuseq{\Gamma}{\Delta, P}{Q}
        \using{left-focus}
      \end{prooftree}
    \]

    \[
      \begin{prooftree}
        (\relj{\blfrel{A}}{\bneuseq{\Gamma, A}{\Delta}{Q}}{s_1 \cdot s_2 \dots s_n})
        \quad s_1 \quad s_2 \quad \dots \quad s_n
        \justifies
        \bneuseq{\Gamma, A}{\Delta}{Q}
        \using{copy-focus}
      \end{prooftree}
    \]
  \end{mdframed}
  \caption{Backward calculus of derived rules}
  \label{fig:bkwdderivedcalculus}
\end{figure}

The following are some facts on the shape of the derivations for which we omit
the easy proof.

\begin{fact}\label{bkwdderfact}
  \begin{enumerate}
  \item If $\bactrelj{\btriseq{\Gamma}{\Delta}{\Omega}{\cdot}}{s}{\Sigma}$, then
    $s \equiv \bneuseq{\Gamma'}{\Delta'}{Q}$ for some $\Gamma', \Delta', Q$;
  \item If $\bactrelj{\btriseq{\Gamma}{\Delta}{\Omega}{C}}{s}{\Sigma}$, then
    $s \equiv \bneuseq{\Gamma'}{\Delta'}{\cdot}$ for some $\Gamma', \Delta'$.
  \end{enumerate}
\end{fact}

\begin{definition}
  A sequent of the backward derived rule calculus $\bneuseq{\Gamma}{\Delta}{Q}$
  is sound if $\btriseq{\Gamma}{\Delta}{\cdot}{\cdot ; Q}$.
\end{definition}

\begin{lemma}\label{bkwdder-soundness-lemma}
  \begin{enumerate}
  \item If $\brfrelj{A}{\bneuseq{\Gamma}{\Delta}{\cdot}}{\Sigma}$ and $\Sigma$
    are sound, then $\rfocseq{\Gamma}{\Delta}{A}$.
  \item If $\blfrelj{A}{\bneuseq{\Gamma}{\Delta}{Q}}{\Sigma}$ and $\Sigma$
    are sound, then $\lfocseq{\Gamma}{\Delta}{A}{Q}$. 
  \item If
    $\bactrelj{\btriseq{\Gamma}{\Delta}{\Omega}{\cdot}}{\bneuseq{\Gamma'}{\Delta'}{Q}}{\Sigma}$
    and $\Sigma$ are sound, then $\btriseq{\Gamma, \Gamma'}{\Delta,
      \Delta'}{\Omega}{\cdot ; Q}$.
  \item If
    $\bactrelj{\btriseq{\Gamma}{\Delta}{\Omega}{\xi}}{\bneuseq{\Gamma'}{\Delta'}{\cdot}}{\Sigma}$
    and $\Sigma$ are sound, then
    $\btriseq{\Gamma, \Gamma'}{\Delta, \Delta'}{\Omega}{R ; \cdot}$ or
    $\btriseq{\Gamma, \Gamma'}{\Delta, \Delta'}{\Omega}{\cdot ; Q}$, depending
    on whether $\xi = R$ or $\xi = Q$.
  \end{enumerate}
\end{lemma}
\begin{proof}
  All points proved simultaneously by induction on the height of the
  derivations. The cases are briefely sketched below.

  \begin{enumerate}
  \item Case the last rule was $\linit$. The thesis follows by immediate
    application of the corresponding $\linit$ rule of the backward focused
    calculus.
    
  \item The $\rinit$ case is dual.
    
  \item Case the last rule was $\otimes F$. The thesis follows immediately by
    inductive hypothesis and application of the $\otimes R$ rule.
    
  \item Case the last rule was $\faplus$.

    \[
      \begin{prooftree}
        \relj{\bactrel{\btriseq{\cdot}{\cdot}{\cdot}{R}}}{s}{\Sigma}
        \justifies
        \relj{\brfrel{R}}{s}{\Sigma}
        \using{\faplus}
      \end{prooftree}
    \]

    By Fact~\ref{bkwdderfact}, $s \equiv \bneuseq{\Gamma}{\Delta}{\cdot}$ for
    some $\Gamma, \Delta$. By inductive hypothesis,
    $\btriseq{\Gamma}{\Delta}{\cdot}{R ; \cdot}$. The thesis follows immediately
    from an application of the $rblur$ rule.
    
  \item Case the last rule is conj+. The thesis follows immediately by
    hypothesis of soundness of the resulting sequents, and an application of
    $\rblurstar$.
    
  \item Case the last rule is $\limp F$. The thesis follows immediately by
    inductive hypothesis and an application of $\limp L$.
    
  \item Case the last rule is $\faminus$.

    \[
      \begin{prooftree}
        \relj{\bactrel{\btriseq{\cdot}{\cdot}{L}{\cdot}}}{s}{\Sigma}
        \justifies
        \relj{\blfrel{L}}{s}{\Sigma}
        \using{\faminus}
      \end{prooftree}
    \]

    By Fact~\ref{bkwdderfact}, $s \equiv \bneuseq{\Gamma}{\Delta}{Q}$. The
    thesis follows immediately by inductive hypothesis and an application of $lblur$.
    
  \item Case the last rule is $conj-$. The thesis follows immediately from
    the hypothesis of soundness of the result sequents, and an application of
    $\lblurstar$.
    
  \item The cases $\otimes A, \limp A, \bact$ are a straightforward application
    of the inductive hypothesis.
    
  \item In the base cases $\matchrule, \matchprimerule$, the thesis follows
    immediately from the hypothesis of $\Sigma$ being sound.

  \end{enumerate}
\end{proof}

\begin{theorem}[Soundness]
  If $\bneuseq{\Gamma}{\Delta}{Q}$ then $\bkwseq{\Gamma}{\Delta}{\cdot ; Q}$.  
\end{theorem}
\begin{proof}
  Straightforward induction on the derivation, and
  Lemma~\ref{bkwdder-soundness-lemma}.
\end{proof}

\begin{lemma}\label{completeness-lemma}
  \begin{enumerate}
    
  \item If $\rfocseq{\Gamma}{\Delta}{A}$, then for some $\Sigma$
    \begin{enumerate}
    \item $\relj{\brfrel{A}}{\bneuseq{\Gamma}{\Delta}{\cdot}}{\Sigma}$, and
    \item $\Sigma$ are all derivable
    \end{enumerate}
    
  \item If $\lfocseq{\Gamma}{\Delta}{A}{Q}$, then for some $\Sigma$
    \begin{enumerate}
    \item $\blfrelj{A}{\bneuseq{\Gamma}{\Delta}{Q}}{\Sigma}$, and
    \item $\Sigma$ are all derivable
    \end{enumerate}
    
  \item If $\btriseq{\Gamma_1, \Gamma_2}{\Delta_1, \Delta_2}{\Omega}{\xi \uplus
      \gamma}$ (where $\xi \uplus \gamma$ means either $\xi$ or $\gamma$ is
    empty), then for some $\Sigma$
    \begin{enumerate}
    \item
      $\bactrelj{\btriseq{\Gamma_1}{\Delta_1}{\Omega}{\xi}}{\bneuseq{\Gamma_2}{\Delta_2}{\gamma}}{\Sigma}$,
      and
    \item $\Sigma$ are all derivable.
    \end{enumerate}
  \end{enumerate}
\end{lemma}
\begin{proof}
  By simultaneous induction on the height of the derivation.
  \begin{enumerate}
  \item Case $\rinit$:

    \[
      \begin{prooftree}
        p \; \text{left-biased}
        \justifies
        \rfocseq{\Gamma}{p}{p}
        \using{\rinit}
      \end{prooftree}
    \]

    then, just apply the $\rinit$ relation.
  \item Case $\linit$ is similar to the case above.
  \item Case $\ract$ is trivial, since the relations corresponding to the
    premise and conclusion sequents are identical.
  \item Case $\lact$. Straightforward use of the $\bact$ rule for derived
    relations.
  \item Case $\rfoc$.
    
    \[
      \begin{prooftree}
        \Gamma; \Delta \gg Q \qquad Q\; \text{right-focusable}
        \justifies
        \Gamma; \Delta; \cdot \Longrightarrow \cdot ; Q
        \using{rfoc}
      \end{prooftree}
    \]

    Suppose $\gamma_1, \gamma_2$ are such that $\gamma_1 \uplus \gamma_2 =
    Q$. Then, the following:

    \[
      \relj{
        \bactrel{\btriseq{\Gamma}{\Delta}{\cdot}{\gamma_1}}
      }{
        \bneuseq{\cdot}{\cdot}{\gamma_2}
      }{
        \bneuseq{\Gamma}{\Delta}{Q}
      }
    \]

    is derivable with either $\matchrule$ or $\matchprimerule$. We need to show
    that $\bneuseq{\Gamma}{\Delta}{Q}$ is derivable. By inductive hypothesis, we
    have $\relj{\brfrel{Q}}{\bneuseq{\Gamma}{\Delta}{\cdot}}{\Sigma}$ for some
    $\Sigma$ all derivable. But then,

    \[
      \begin{prooftree}
        \relj{\brfrel{Q}}{\bneuseq{\Gamma}{\Delta}{\cdot}}{\Sigma}
        \qquad \Sigma
        \justifies
        \bneuseq{\Gamma}{\Delta}{Q}
        \using{\rightfocusrule}
      \end{prooftree}
    \]

  \item Case $\lfoc$ is just analogous to $\rfoc$, with an application of
    $\leftfocusrule$.
  \item Case $\rblur$.

    \[
      \begin{prooftree}
        \Gamma; \Delta; \cdot \Longrightarrow R; \cdot
        \justifies
        \Gamma; \Delta \gg R
        \using{\rblur}
      \end{prooftree}
    \]

    By inductive hypothesis, we have
    $\relj{\bactrel{\btriseq{\cdot}{\cdot}{\cdot}{R}}}{\bneuseq{\Gamma}{\Delta}{\cdot}}{\Sigma}$,
    where all $\Sigma$ are derivable. But
    then, we can apply the rule $\faplus$ to get the thesis

    \[
      \begin{prooftree}
        \relj{\bactrel{\btriseq{\cdot}{\cdot}{\cdot}{R}}}{\bneuseq{\Gamma}{\Delta}{\cdot}}{\Sigma}
        \justifies
        \relj{\brfrel{R}}{\bneuseq{\Gamma}{\Delta}{\cdot}}{\Sigma}
        \using{FA^+}
      \end{prooftree}
    \]
    
  \item Case $\lblur$ is dual to $\rblur$.
  \item Case $\rblurstar$.

    \[
      \begin{prooftree}
        \Gamma; \Delta; \cdot \Longrightarrow \cdot ; p \qquad p \; \text{right-biased}
        \justifies
        \Gamma; \Delta \gg p
        \using{rblur^*}
      \end{prooftree}
    \]

    By inductive hypothesis,
    $\relj{\bactrel{\btriseq{\Gamma}{\Delta}{\cdot}{p}}}{\bneuseq{\cdot}{\cdot}{\cdot}}{\Sigma}$,
    that must have been derived by $\matchprimerule$. Therefore, $\Sigma \equiv
    \bneuseq{\Gamma}{\Delta}{p}$, which is by hypothesis derivable.
    Then, we can apply $\faplusstar$ to get
    $\relj{\brfrel{p}}{\bneuseq{\Gamma}{\Delta}{\cdot}}{\bneuseq{\Gamma}{\Delta}{p}}$.

  \item Case $\lblurstar$ is dual to $\rblurstar$.
  \item Case $\copyrule$.

    \[
      \begin{prooftree}
        \Gamma, A; \Delta ; A \ll Q
        \justifies
        \Gamma, A; \Delta; \cdot \Longrightarrow \cdot; Q
        \using{\copyrule}
      \end{prooftree}
    \]

    We can apply $\matchrule$ to immediately derive

    \[
      \begin{prooftree}
        \justifies
        \relj{\bactrel{\btriseq{\Gamma,
              A}{\Delta}{\cdot}{\cdot}}}{\bneuseq{\cdot}{\cdot}{Q}}{\bneuseq{\Gamma,
            A}{\Delta}{Q}}
        \using{\matchrule}
      \end{prooftree}
    \]

    and see that $\bneuseq{\Gamma, A}{\Delta}{Q}$ is derivable by
    the inductive hypothesis
    $\relj{\blfrel{A}}{\bneuseq{\Gamma,A}{\Delta}{Q}}{\Sigma}$ and an application
    of $\copyfocusrule$.
  \item The remaining rules of the connectives are straightforward application
    of the inductive hypothesis.
  \end{enumerate}
\end{proof}

\begin{theorem}[Completeness]
  If $\btriseq{\Gamma}{\Delta}{\cdot}{\cdot ; Q}$, then
  $\bneuseq{\Gamma}{\Delta}{Q}$.
\end{theorem}
\begin{proof}
  Straightforward application of Lemma~\ref{completeness-lemma}. The last rule
  used to derive $\btriseq{\Gamma}{\Delta}{\cdot}{\cdot ; Q}$ is one of
  $\lfoc, \rfoc$ or $\copyrule$; correspondingly, by the Lemma, we have the
  derived rules to use as premises of $\rightfocusrule, \leftfocusrule$ and
  $\copyfocusrule$ which derive $\bneuseq{\Gamma}{\Delta}{Q}$.
\end{proof}

\subsection{Forward derived rules}

In the following rules, $\gamma \setminus \xi$ is defined as $\gamma$ if $\xi = \cdot$,
and as $\cdot$ if $\gamma = \xi$.

\begin{figure}[ht]
  \begin{mdframed}
    \[
      \begin{prooftree}
        p \; \text{left-biased}
        \justifies
        \relj{\frfrel{p}}{\cdot}{\fneuseq{\cdot}{p}{\cdot}}
        \using{\linit}
      \end{prooftree}
      \qquad\qquad
      \begin{prooftree}
        p \; \text{right-based}
        \justifies
        \relj{\flfrel{p}}{\cdot}{\fneuseq{\cdot}{\cdot}{p}}
        \using{\linit}
      \end{prooftree}
    \]

    \[
      \begin{prooftree}
        \relj{\factrel{\btriseq{\cdot}{\cdot}{\cdot}{R}}}{\Sigma}{s}
        \justifies
        \relj{\frfrel{R}}{\Sigma}{s}
        \using{\faplus}
      \end{prooftree}
      \qquad \qquad
      \begin{prooftree}
        \relj{\factrel{\btriseq{\cdot}{\cdot}{L}{\cdot}}}{\Sigma}{s}
        \justifies
        \relj{\flfrel{L}}{\Sigma}{s}
        \using{\faminus}
      \end{prooftree}
    \]

    \[
      \begin{prooftree}
        p \text{ right-biased}
        \justifies
        \frfrelj{p}{\fneuseq{\Gamma}{\Delta}{p}}{\fneuseq{\Gamma}{\Delta}{\cdot}}
        \using{conj^+}
      \end{prooftree}
    \]

    \[
      \begin{prooftree}
        p \text{ left-biased}
        \justifies
        \flfrelj{p}{\fneuseq{\Gamma}{\Delta, p}{Q}}{\fneuseq{\Gamma}{\Delta}{Q}}
        \using{conj^-}
      \end{prooftree}
    \]

    \[
      \begin{prooftree}
        \relj{\flfrel{B}}{\Sigma_1}{\fneuseq{\Gamma_1}{\Delta_1}{\gamma}}
        \qquad
        \relj{\frfrel{A}}{\Sigma_2}{\fneuseq{\Gamma_2}{\Delta_2}{\cdot}}
        \justifies
        \relj{\flfrel{A \limp B}}{\Sigma_1 \cdot \Sigma_2}{\fneuseq{\Gamma_1,
            \Gamma_2}{\Delta_1, \Delta_2}{\gamma}}
        \using{\limp F}
      \end{prooftree}
    \]

    \[
      \begin{prooftree}
        \relj{\frfrel{A}}{\Sigma_1}{\fneuseq{\Gamma_1}{\Delta_1}{\cdot}}
        \qquad
        \relj{\frfrel{B}}{\Sigma_2}{\fneuseq{\Gamma_2}{\Delta_2}{\cdot}}
        \justifies
        \relj{\frfrel{A \otimes B}}{\Sigma_1 \cdot \Sigma_2}{\fneuseq{\Gamma_1,
            \Gamma_2}{\Delta_1, \Delta_2}{\cdot}}
        \using{\otimes F}
      \end{prooftree}
    \]

    \[
      \begin{prooftree}
        \relj{\factrel{\btriseq{\Gamma}{\Delta}{\Omega \cdot A}{B}}}{\Sigma}{s}
        \justifies
        \relj{\factrel{\btriseq{\Gamma}{\Delta}{\Omega}{A \limp B}}}{\Sigma}{s}
        \using{\limp A}
      \end{prooftree}
    \]

    \[
      \begin{prooftree}
        \relj{\factrel{
            \btriseq{\Gamma}{\Delta}{\Omega \cdot A \cdot B \cdot \Omega'}{\xi}}
        }{\Sigma}{s}
        \justifies
        \relj{\factrel{
            \btriseq{\Gamma}{\Delta}{\Omega \cdot A \otimes B \cdot \Omega'}{\xi}}
        }{\Sigma}{s}
        \using{\otimes A}
      \end{prooftree}
    \]

    \[
      \begin{prooftree}
        \relj{\factrel{\btriseq{\Gamma}{\Delta, P}{\Omega \cdot \Omega'}{\xi}}}{\Sigma}{s}
        \justifies
        \relj{\factrel{\btriseq{\Gamma}{\Delta}{\Omega \cdot P \cdot \Omega'}{\xi}}}{\Sigma}{s}
        \using{\actrule}
      \end{prooftree}
    \]

    \[
      \begin{prooftree}
        \xi \subseteq \gamma
        \justifies
        \relj{
          \factrel{\btriseq{\Gamma}{\Delta}{\cdot}{\xi}}
        }{
          \fneuseq{\Gamma, \Gamma'}{\Delta, \Delta'}{\gamma}
        }{
          \fneuseq{\Gamma'}{\Delta'}{\gamma \setminus \xi}
        }
        \using{\matchrule}
      \end{prooftree}
    \]
  \end{mdframed}
  \caption{Forward focused derived rule calculus}
\end{figure}

The derived rule for positive subformulas is:

\[
  \begin{prooftree}
    s_1 \quad \dots \quad s_n \quad
    (\relj{\frfrel{Q}}{s_1 \dots s_n}{\fneuseq{\Gamma}{\Delta}{\cdot}})
    \justifies
    \fneuseq{\Gamma}{\Delta}{Q}
    \using{\focplusrule}
  \end{prooftree}
\]

Similarly, for negative propositions, we have two rules:

\[
  \begin{prooftree}
    s_1 \quad \dots \quad s_n \quad
    (\relj{\flfrel{P}}{s_1 \dots s_n}{\fneuseq{\Gamma}{\Delta}{Q}})
    \justifies
    \fneuseq{\Gamma}{\Delta, P}{Q}
    \using{\focminusrule}
  \end{prooftree}
\]

\[
  \begin{prooftree}
    s_1 \quad \dots \quad s_n \quad
    (\relj{\flfrel{A}}{s_1 \dots s_n}{\fneuseq{\Gamma}{\Delta}{Q}})
    \justifies
    \fneuseq{\Gamma, A}{\Delta}{Q}
    \using{\foccopyrule}
  \end{prooftree}
\]

\begin{fact}\label{forwardfact}
  \begin{enumerate}
  \item If $\relj{\factrel{\btriseq{\Gamma}{\Delta}{\Omega}{\xi}}}{\Sigma}
    {\fneuseq{\Gamma'}{\Delta'}{\gamma}}$, then either
    \begin{enumerate}
    \item $\xi = \cdot$ and $\gamma = Q$ for some right-synchronous $Q$;
    \item $\xi = C$ and $\gamma = \cdot$ for some $C$.
    \end{enumerate}
    
  \item If $\relj{\flfrel{A}}{\Sigma}{\fneuseq{\Gamma}{\Delta}{\gamma}}$, then
    $\gamma = Q$ for some right-synchronous $Q$.
  \end{enumerate}
\end{fact}

\begin{definition}
  The sequent $\fneuseq{\Gamma}{\Delta}{Q}$ is sound if
  $\btriseq{\Gamma}{\Delta}{\cdot}{\cdot ; Q}$.
\end{definition}

\begin{lemma}\label{fsoundnesslemma}
  If $\Sigma$ are sound, then

  \begin{enumerate}
  \item If $\relj{\frfrel{A}}{\Sigma}{\fneuseq{\Gamma}{\Delta}{\cdot}}$,
    then, $\rfocseq{\Gamma}{\Delta}{A}$;
  \item If $\relj{\flfrel{A}}{\Sigma}{\fneuseq{\Gamma}{\Delta}{Q}}$,
    then $\lfocseq{\Gamma}{\Delta}{A}{Q}$;
  \item If
    $\relj{\factrel{\btriseq{\Gamma}{\Delta}{\Omega}{\cdot}}}{\Sigma}
    {\fneuseq{\Gamma'}{\Delta'}{Q}}$, then
    $\btriseq{\Gamma, \Gamma'}{\Delta, \Delta'}{\Omega}{\cdot ; Q}$;
  \item If
    $\relj{\factrel{\btriseq{\Gamma}{\Delta}{\Omega}{C}}}{\Sigma}
    {\fneuseq{\Gamma'}{\Delta'}{\cdot}}$, then
    $\btriseq{\Gamma, \Gamma'}{\Delta, \Delta'}{\Omega}{C ; \cdot}$ or
    $\btriseq{\Gamma, \Gamma'}{\Delta, \Delta'}{\Omega}{\cdot ; C}$, depending
    on whether $C$ is right-asynchronous or right-synchronous, respectively.
  \end{enumerate}
\end{lemma}
\begin{proof}
  All points proved by simultaneous induction on the height of the
  derivation. We distinguish cases on the last rule used in the derivation:

  \begin{itemize}
  \item Case $\linit$. Hence,
    $\relj{\frfrel{p}}{\cdot}{\fneuseq{\cdot}{p}{\cdot}}$ and $p$ is
    left-biased. Then,

    \[
      \begin{prooftree}
        p \; \text{left-biased}
        \justifies
        \rfocseq{\cdot}{p}{p}
      \end{prooftree}
    \]

    By soundness of the backward focused calculus, $\bkwseq{\cdot}{p}{p}$. 

  \item Case $\rinit$ is similar;
  \item Case $\faplus{}$.

    \[
      \begin{prooftree}
        \relj{
          \factrel{\btriseq{\cdot}{\cdot}{\cdot}{R}}
        }{
          \Sigma
        }{
          s
        }
        \justifies
        \relj{\frfrel{R}}{\Sigma}{s}
        \using{\faplus}
      \end{prooftree}
    \]

    By Fact~\ref{forwardfact}, $s \equiv
    \fneuseq{\Gamma'}{\Delta'}{\cdot}$ for some $\Gamma', \Delta'$, and by
    inductive hypothesis $\btriseq{\Gamma'}{\Delta'}{\cdot}{R ; \cdot}$. Then,

    \[
      \begin{prooftree}
        \btriseq{\Gamma'}{\Delta'}{\cdot}{R ; \cdot}
        \justifies
        \rfocseq{\Gamma'}{\Delta'}{R}
        \using{\rblur}
      \end{prooftree}
    \]
    
  \item Case $\faminus$.

    \[
      \begin{prooftree}
        \relj{\factrel{\btriseq{\cdot}{\cdot}{L}{\cdot}}}{\Sigma}{s}
        \justifies
        \relj{\flfrel{L}}{\Sigma}{s}
        \using{\faminus}
      \end{prooftree}
    \]
    By Fact~\ref{forwardfact}, $s \equiv \fneuseq{\Gamma'}{\Delta'}{Q}$, then by
    inductive hypothesis $\btriseq{\Gamma'}{\Delta'}{L}{\cdot ; Q}$. Then,

    \[
      \begin{prooftree}
        \btriseq{\Gamma'}{\Delta'}{L}{\cdot ; Q}
        \justifies
        \lfocseq{\Gamma'}{\Delta'}{L}{Q}
        \using{\lblur}
      \end{prooftree}
    \]
        
  \item Case $\limp F$.
    
    \[
      \begin{prooftree}
        \relj{\flfrel{B}}{\Sigma_1}{\fneuseq{\Gamma_1}{\Delta_1}{\gamma}}
        \qquad
        \relj{\frfrel{A}}{\Sigma_2}{\fneuseq{\Gamma_2}{\Delta_2}{\cdot}}
        \justifies
        \relj{\flfrel{A \limp B}}{\Sigma_1 \cdot \Sigma_2}{\fneuseq{\Gamma_1,
            \Gamma_2}{\Delta_1, \Delta_2}{\gamma}}
        \using{\limp F}
      \end{prooftree}
    \]

    Then, by Fact~\ref{forwardfact} and inductive hypothesis

    \[
      \lfocseq{\Gamma_1}{\Delta_1}{B}{Q} \qquad \qquad
      \rfocseq{\Gamma_2}{\Delta_2}{A}
    \]

    for some right-synchronous $Q$. Then, by weakening and $\limp L$:

    \[
      \begin{prooftree}
        \[
          \lfocseq{\Gamma_1}{\Delta_1}{B}{Q}
          \justifies
          \lfocseq{\Gamma_1, \Gamma_2}{\Delta_1}{B}{Q}
        \]
        \qquad
        \[
          \rfocseq{\Gamma_2}{\Delta_2}{A}
          \justifies
          \rfocseq{\Gamma_1, \Gamma_2}{\Delta_2}{A}
        \]
        \justifies
        \lfocseq{\Gamma_1, \Gamma_2}{\Delta_1, \Delta_2}{A \limp B}{Q}
      \end{prooftree}
    \]

  \item Case $\otimes F$.
    
    \[
      \begin{prooftree}
        \relj{\frfrel{A}}{\Sigma_1}{\fneuseq{\Gamma_1}{\Delta_1}{\cdot}}
        \qquad
        \relj{\frfrel{B}}{\Sigma_2}{\fneuseq{\Gamma_2}{\Delta_2}{\cdot}}
        \justifies
        \relj{\frfrel{A \otimes B}}{\Sigma_1 \cdot \Sigma_2}{\fneuseq{\Gamma_1,
            \Gamma_2}{\Delta_1, \Delta_2}{\cdot}}
        \using{\otimes F}
      \end{prooftree}
    \]

    Then, by inductive hypothesis

    \[
      \rfocseq{\Gamma_1}{\Delta_1}{A} \qquad \qquad
      \rfocseq{\Gamma_2}{\Delta_2}{B}
    \]

    Then, by weakening and $\otimes R$:

    \[
      \begin{prooftree}
        \[
          \rfocseq{\Gamma_1}{\Delta_1}{A}
          \justifies
          \rfocseq{\Gamma_1, \Gamma_2}{\Delta_1}{A}
        \]
        \qquad
        \[
          \rfocseq{\Gamma_2}{\Delta_2}{B}
          \justifies
          \rfocseq{\Gamma_1, \Gamma_2}{\Delta_2}{B}
        \]
        \justifies
        \rfocseq{\Gamma_1, \Gamma_2}{\Delta_1, \Delta_2}{A \otimes B}
      \end{prooftree}
    \]

  \item Case $\limp A$.

    \[
      \begin{prooftree}
        \relj{\factrel{\btriseq{\Gamma}{\Delta}{\Omega \cdot A}{B}}}{\Sigma}{s}
        \justifies
        \relj{\factrel{\btriseq{\Gamma}{\Delta}{\Omega}{A \limp B}}}{\Sigma}{s}
        \using{\limp A}
      \end{prooftree}
    \]

    By Fact~\ref{forwardfact}, $s \equiv \fneuseq{\Gamma'}{\Delta'}{\cdot}$ for
    some $\Gamma', \Delta'$. By inductive hypothesis $\btriseq{\Gamma,
      \Gamma'}{\Delta, \Delta'}{\Omega \cdot A}{B ; \cdot}$ (if $B$ is
    right-synchronous, it sufficies to apply $\ract$). Then, by $\limp R$

    \[
      \begin{prooftree}
        \btriseq{\Gamma,
          \Gamma'}{\Delta, \Delta'}{\Omega \cdot A}{B ; \cdot}
        \justifies
        \btriseq{\Gamma,
          \Gamma'}{\Delta, \Delta'}{\Omega}{A \limp B ; \cdot}
      \end{prooftree}
    \]

  \item Case $\otimes A$ is analogous.
  \item Case $act$.

    \[
      \begin{prooftree}
        \relj{\factrel{\btriseq{\Gamma}{\Delta, P}{\Omega \cdot \Omega'}{\xi}}}{\Sigma}{s}
        \justifies
        \relj{\factrel{\btriseq{\Gamma}{\Delta}{\Omega \cdot P \cdot \Omega'}{\xi}}}{\Sigma}{s}
        \using{act}
      \end{prooftree}
    \]

    \begin{enumerate}
    \item Case $\xi = \cdot$. Then, by Fact~\ref{forwardfact},
      $s \equiv \fneuseq{\Gamma'}{\Delta'}{Q}$ for some $Q$. Then, by inductive
      hypothesis,
      $\btriseq{\Gamma, \Gamma'}{\Delta, \Delta', P}{\Omega \cdot \Omega'}{\cdot
        ; Q}$. The thesis follows by application of the $lact$ rule.
      
    \item Case $\xi = C$ for some $C$. Then, by Fact~\ref{forwardfact},
      $s \equiv \fneuseq{\Gamma'}{\Delta'}{\cdot}$. Then, by inductive
      hypothesis,
      $\btriseq{\Gamma, \Gamma'}{\Delta, \Delta', P}{\Omega \cdot
        \Omega'}{\gamma}$, where $\gamma$ is either $C ; \cdot$ and $\cdot ;
      C$. The thesis follows again by application of the $lact$ rule.
    \end{enumerate}

  \item Case $match$.
    \begin{enumerate}
    \item Case $\xi = \cdot$. Then

      \[
        \begin{prooftree}
          \justifies
          \relj{
            \factrel{\btriseq{\Gamma}{\Delta}{\cdot}{\cdot}}
          }{
            \fneuseq{\Gamma, \Gamma'}{\Delta, \Delta'}{Q}
          }{
            \fneuseq{\Gamma'}{\Delta'}{Q}
          }
          \using{match}
        \end{prooftree}
      \]

      Then we need to prove the derivability of $\btriseq{\Gamma,
        \Gamma'}{\Delta, \Delta'}{\cdot}{\cdot ; Q}$, but this comes from the
      hypothesis that $\fneuseq{\Gamma, \Gamma'}{\Delta, \Delta'}{Q}$ be sound.

    \item Case $\xi = C$. Then, $C \equiv Q$ and
      
      \[
        \begin{prooftree}
          \justifies
          \relj{
            \factrel{\btriseq{\Gamma}{\Delta}{\cdot}{Q}}
          }{
            \fneuseq{\Gamma, \Gamma'}{\Delta, \Delta'}{Q}
          }{
            \fneuseq{\Gamma'}{\Delta'}{\cdot}
          }
          \using{match}
        \end{prooftree}
      \]

      The rest is as above.
    \end{enumerate}
  \end{itemize}
\end{proof}

\begin{theorem}[Soundness]
  If $\fneuseq{\Gamma}{\Delta}{Q}$, then it is sound.
\end{theorem}
\begin{proof}
  By induction on the height of the derivation of
  $\fneuseq{\Gamma}{\Delta}{Q}$. We distinguish three cases

  \begin{enumerate}
  \item Case $focplus$
    
    \[
      \begin{prooftree}
        s_1 \quad \dots \quad s_n \quad
        (\relj{\frfrel{Q}}{s_1 \dots s_n}{\fneuseq{\Gamma}{\Delta}{\cdot}})
        \justifies
        \fneuseq{\Gamma}{\Delta}{Q}
        \using{foc plus}
      \end{prooftree}
    \]

    By Lemma~\ref{fsoundnesslemma}, $\rfocseq{\Gamma}{\Delta}{Q}$. The thesis
    follows by $\rfoc$.
    
  \item Case $focminus$.
    
    \[
      \begin{prooftree}
        s_1 \quad \dots \quad s_n \quad
        (\relj{\flfrel{P}}{s_1 \dots s_n}{\fneuseq{\Gamma}{\Delta}{Q}})
        \justifies
        \fneuseq{\Gamma}{\Delta, P}{Q}
        \using{foc minus}
      \end{prooftree}
    \]

    By Lemma~\ref{fsoundnesslemma}, $\lfocseq{\Gamma}{\Delta}{P}{Q}$. The thesis
    follows by $\lfoc$.
    
  \item Case $!focminus$.
    
    \[
      \begin{prooftree}
        s_1 \quad \dots \quad s_n \quad
        (\relj{\flfrel{A}}{s_1 \dots s_n}{\fneuseq{\Gamma}{\Delta}{Q}})
        \justifies
        \fneuseq{\Gamma, A}{\Delta}{Q}
        \using{! foc minus}
      \end{prooftree}
    \]

    By Lemma~\ref{fsoundnesslemma}, $\lfocseq{\Gamma}{\Delta}{A}{Q}$. The thesis
    follows by $copy$.
  \end{enumerate}
\end{proof}

Completeness is established with respect to the backward calculus of derived
rules.

\begin{definition}[Stronger forms]
  A forward sequent $\fneuseq{\Gamma}{\Delta}{G}$ is said to be stronger than a
  backward derived sequent $\bneuseq{\Gamma'}{\Delta'}{G'}$, written as a
  relation $\preceq$, if $\Gamma \subseteq \Gamma'$, $\Delta = \Delta'$, and
  $G = G'$.
\end{definition}

The above relation is assumed to be extended point-wise to ordered sequences of
sequents.

\begin{lemma}\label{fdercompllemma}
  \begin{enumerate}
  \item If $\brfrelj{A}{s}{\Sigma}$ and there exists a derivable sequence of
    sequents $\Sigma' \preceq \Sigma$ for which $\frfrelj{A}{\Sigma'}{s'}$, then
    $s' \preceq s$;
  \item If $\blfrelj{A}{s}{\Sigma}$ and there exists a derivable sequence
    $\Sigma' \preceq \Sigma$ for which $\flfrelj{A}{\Sigma'}{s'}$, then $s'
    \preceq s$;
  \item If $\bactrelj{\btriseq{\Gamma}{\Delta}{\Omega}{\xi}}{s}{\Sigma}$ and
    there exists a derivable sequence $\Sigma' \preceq \Sigma$ for which
    $\factrelj{\btriseq{\Gamma}{\Delta}{\Omega}{\xi}}{\Sigma'}{s'}$, then
    $s' \preceq s$.
  \end{enumerate}
\end{lemma}
\begin{proof}
  All points proved simultaneously by induction on the height of the backward
  relation derivation.

  \begin{enumerate}
  \item Case $\linit$.

    \[
      \begin{prooftree}
        p \; \text{right-biased}
        \justifies
        \relj{\blfrel{p}}{\bneuseq{\Gamma}{\cdot}{p}}{\cdot}
        \using{\linit}
      \end{prooftree}
    \]

    Suppose there exists a derivable sequence $\Sigma' \preceq \cdot$ such that
    $\relj{\flfrel{p}}{\Sigma'}{s'}$ is derivable. Then, it must have been an
    application of the corresponding forward $\linit$ rule:

    \[
      \begin{prooftree}
        p \; \text{right-based}
        \justifies
        \relj{\flfrel{p}}{\cdot}{\fneuseq{\cdot}{\cdot}{p}}
        \using{\linit}
      \end{prooftree}
    \]

    where indeed $\Sigma' \equiv \cdot$ and $s' \equiv
    \fneuseq{\cdot}{\cdot}{p}$. The thesis follows immediately.

  \item Case $\rinit$. That is, we have a derivation

    \[
      \begin{prooftree}
        p \; \text{left-biased}
        \justifies
        \relj{\brfrel{p}}{\bneuseq{\Gamma}{p}{\cdot}}{\cdot}
        \using{\rinit}
      \end{prooftree}
    \]

    and suppose there are $\Sigma' \preceq \cdot$ and a derivation of
    $\relj{\frfrel{p}}{\Sigma'}{s'}$. Then, it must be that $\Sigma' = \cdot$ and

    \[
      \begin{prooftree}
        p \; \text{left-biased}
        \justifies
        \relj{\frfrel{p}}{\cdot}{\fneuseq{\cdot}{p}{\cdot}}
        \using{\rinit}
      \end{prooftree}
    \]

    Then $s' \equiv \fneuseq{\cdot}{p}{\cdot}$, which clearly satisfies the
    thesis.

  \item Case $\faplus$. Then

    \[
      \begin{prooftree}
        \relj{\bactrel{\btriseq{\cdot}{\cdot}{\cdot}{R}}}{s}{\Sigma}
        \justifies
        \relj{\brfrel{R}}{s}{\Sigma}
        \using{FA^+}
      \end{prooftree}
    \]
    
    Suppose there are $\Sigma' \preceq \Sigma$ such that
    $\frfrelj{R}{\Sigma'}{s'}$. Then, it must have been derived with an
    application of the rule $\faplus$.

    \[
      \begin{prooftree}
        \relj{\factrel{\btriseq{\cdot}{\cdot}{\cdot}{R}}}{\Sigma'}{s'}
        \justifies
        \relj{\frfrel{R}}{\Sigma'}{s'}
        \using{\faplus}
      \end{prooftree}
    \]

    The thesis follows immediately from the inductive hypothesis.
    
  \item Case $conj+$. Then, 

    \[
      \begin{prooftree}
        p \; \text{right-biased}
        \justifies
        \relj{\brfrel{p}}{\bneuseq{\Gamma}{\Delta}{\cdot}}{\bneuseq{\Gamma}{\Delta}{p}}
        \using{conj^+}
      \end{prooftree}
    \]

    where $\Sigma \equiv \bneuseq{\Gamma}{\Delta}{p}$ and
    $s \equiv \bneuseq{\Gamma}{\Delta}{\cdot}$. Suppose there is some $\Sigma'
    \preceq \Sigma$ and $s'$ such that $\frfrelj{p}{\Sigma'}{s'}$.
    Then, it must have been derived by an application of $conj+$, hence
    $\Sigma' \equiv \fneuseq{\Gamma'}{\Delta'}{p}$ and
    $s' \equiv \fneuseq{\Gamma'}{\Delta'}{\cdot}$.

    By hypothesis, $\Sigma' \preceq \Sigma$ hence $\Gamma' \subseteq \Gamma$ and
    $\Delta = \Delta'$. It follows that $s' \preceq s$.

      \item Case $\otimes F$:

    \[
      \begin{prooftree}
        \relj{\brfrel{A}}{\bneuseq{\Gamma}{\Delta_1}{\cdot}}{\Sigma_1}
        \qquad
        \relj{\brfrel{B}}{\bneuseq{\Gamma}{\Delta_2}{\cdot}}{\Sigma_2}
        \justifies
        \relj{\brfrel{A \otimes B}}{\bneuseq{\Gamma}{\Delta_1,
            \Delta_2}{\cdot}}{\Sigma_1 \cdot \Sigma_2}
        \using{\otimes F}
      \end{prooftree}
    \]

    By hypothesis, there is $(\Sigma_1' \cdot \Sigma_2') \preceq (\Sigma_1 \cdot
    \Sigma_2)$ such that

    \[
      \begin{prooftree}
        \relj{\frfrel{A}}{\Sigma_1'}{\fneuseq{\Gamma_1'}{\Delta_1'}{\cdot}}
        \qquad
        \relj{\frfrel{B}}{\Sigma_2'}{\fneuseq{\Gamma_2'}{\Delta_2'}{\cdot}}
        \justifies
        \relj{\frfrel{A \otimes B}}{\Sigma_1' \cdot \Sigma_2'}{\fneuseq{\Gamma_1',
            \Gamma_2'}{\Delta_1', \Delta_2'}{\cdot}}
        \using{\otimes F}
      \end{prooftree}
    \]

    For some $\Gamma_1', \Gamma_2', \Delta_1', \Delta_2'$. By inductive
    hypothesis, $\Gamma_1' \subseteq \Gamma$, $\Gamma_2' \subseteq \Gamma$,
    $\Delta_1 = \Delta_1'$, $\Delta_2 = \Delta_2'$. It follows that $\Gamma_1,
    \Gamma_2 \subseteq \Gamma$ and $\Delta_1, \Delta_2 = \Delta_1', \Delta_2'$.
    
  \item Case $\limp F$.

    \[
      \begin{prooftree}
        \relj{\blfrel{B}}{\bneuseq{\Gamma}{\Delta_1}{Q}}{\Sigma_1} \qquad
        \relj{\brfrel{A}}{\bneuseq{\Gamma}{\Delta_2}{\cdot}}{\Sigma_2}
        \justifies
        \relj{\blfrel{A \limp B}}{\bneuseq{\Gamma}{\Delta_1,\Delta_2}{Q}}{\Sigma_1
          \cdot \Sigma_2}
        \using{\limp F}
      \end{prooftree}
    \]

    Suppose $(\Sigma_1' \cdot \Sigma_2') \preceq (\Sigma_1 \cdot \Sigma_2)$ such
    that $\relj{\flfrel{A \limp B}}{\Sigma_1' \cdot \Sigma_2'}{s'}$. Then, it
    must have been derived by an application of the corresponding $\limp F$
    rule.

    \[
      \begin{prooftree}
        \relj{\flfrel{B}}{\Sigma_1'}{\fneuseq{\Gamma_1'}{\Delta_1'}{Q'}}
        \qquad
        \relj{\frfrel{A}}{\Sigma_2'}{\fneuseq{\Gamma_2'}{\Delta_2'}{\cdot}}
        \justifies
        \relj{\flfrel{A \limp B}}{\Sigma_1' \cdot \Sigma_2'}{\fneuseq{\Gamma_1'
            \cup \Gamma_2'}{\Delta_1', \Delta_2'}{Q'}}
        \using{\limp F}
      \end{prooftree}
    \]

    By inductive hypothesis, $\Gamma_1' \subseteq \Gamma, \Gamma_2' \subseteq
    \Gamma, \Delta_1' = \Delta_1, \Delta_2' = \Delta_2, Q = Q'$. Therefore,
    $\Gamma_1' \cup \Gamma_2 \subseteq \Gamma$ and
    $\Delta_1', \Delta_2' = \Delta_1, \Delta_2$. The thesis follows immediately.
    
  \item Case $\otimes A$.

    \[
      \begin{prooftree}
        \relj{\bactrel{\btriseq{\Gamma}{\Delta}{\Omega \cdot A \cdot B \cdot
              \Omega'}{\xi}}}{s}{\Sigma}
        \justifies
        \relj{\bactrel{\btriseq{\Gamma}{\Delta}{\Omega \cdot A \otimes B \cdot
              \Omega'}{\xi}}}{s}{\Sigma}
        \using{\otimes A}
      \end{prooftree}
    \]

    Suppose $\Sigma' \preceq \Sigma$ such that
    $\relj{\factrel{ \btriseq{\Gamma}{\Delta}{\Omega \cdot A \otimes B \cdot
          \Omega'}{\xi}} }{\Sigma'}{s'}$. Then, it must have been derived by an
    application of the corresponding $\otimes A$ rule:

    \[
      \begin{prooftree}
        \relj{\factrel{
            \btriseq{\Gamma}{\Delta}{\Omega \cdot A \cdot B \cdot \Omega'}{\xi}}
        }{\Sigma'}{s'}
        \justifies
        \relj{\factrel{
            \btriseq{\Gamma}{\Delta}{\Omega \cdot A \otimes B \cdot \Omega'}{\xi}}
        }{\Sigma'}{s'}
        \using{\otimes A}
      \end{prooftree}
    \]

    The thesis follows immediately from the inductive hypothesis.
    
  \item Cases $\limp A$ and $bact$ are treated similarly.
    
  \item Case $\faminus$.

    \[
      \begin{prooftree}
        \relj{\bactrel{\btriseq{\cdot}{\cdot}{L}{\cdot}}}{s}{\Sigma}
        \justifies
        \relj{\blfrel{L}}{s}{\Sigma}
        \using{FA^-}
      \end{prooftree}
    \]

    Suppose there exists $\Sigma' \preceq \Sigma$ such that
    $\relj{\flfrel{L}}{\Sigma'}{s'}$. Then, it must have been derived with a
    corresponding application of $\faminus$:

    \[
      \begin{prooftree}
        \relj{\factrel{\btriseq{\cdot}{\cdot}{L}{\cdot}}}{\Sigma'}{s'}
        \justifies
        \relj{\flfrel{L}}{\Sigma'}{s'}
        \using{\faminus}
      \end{prooftree}
    \]

    By inductive hypothesis, $s' \preceq s$.
    
  \item Case $conj-$.

    \[
      \begin{prooftree}
        p \; \text{left-biased}
        \justifies
        \relj{\blfrel{p}}{\bneuseq{\Gamma}{\Delta}{Q}}{\bneuseq{\Gamma}{\Delta, p}{Q}}
        \using{conj^-}
      \end{prooftree}
    \]

    Suppose $\Sigma' \preceq \Sigma$ for which
    $\flfrelj{p}{\Sigma'}{s'}$. Then, it must have been derived by an
    application of the corresponding $conj-$:

    \[
      \begin{prooftree}
        p~\text{left-biased}
        \justifies
        \flfrelj{p}{\fneuseq{\Gamma'}{\Delta', p}{Q'}}{\fneuseq{\Gamma'}{\Delta'}{Q'}}        
      \end{prooftree}
    \]

    By hypothesis, $\Gamma' \subseteq \Gamma, \Delta = \Delta', Q = Q'$. Hence
    $s' \preceq s$.

  \item Case $\matchrule$.

    \[
      \begin{prooftree}
        \justifies
        \relj{
          \bactrel{\btriseq{\Gamma}{\Delta}{\cdot}{\cdot}}
        }{
          \bneuseq{\Gamma'}{\Delta'}{Q}
        }{
          \bneuseq{\Gamma, \Gamma'}{\Delta, \Delta'}{Q}
        }
        \using{\matchrule}
      \end{prooftree}
    \]

    Suppose $\Sigma' \preceq \Sigma$ such that
    $\relj{ \factrel{\btriseq{\Gamma}{\Delta}{\cdot}{\cdot}} }{ \Sigma' }{ s'
    }$. Then, it must have been an application of the $\matchrule$ rule such that:
    
    \[
      \begin{prooftree}
        \justifies
        \relj{
          \factrel{\btriseq{\Gamma}{\Delta}{\cdot}{\cdot}}
        }{
          \fneuseq{\Gamma, \Gamma''}{\Delta, \Delta''}{Q'}
        }{
          \fneuseq{\Gamma''}{\Delta''}{Q'}
        }
        \using{\matchrule}
      \end{prooftree}
    \]

    remembering that $\Gamma, \Gamma''$ is supposed to be a partitioning of the
    unrestricted context of the input sequent, hence
    $\Gamma \cap \Gamma'' = \empty$.  From $\Sigma' \preceq \Sigma$ it follows
    that $Q \equiv Q'$ and $\Delta, \Delta' = \Delta, \Delta''$, hence $\Delta'
    = \Delta''$.
    Moreover, we have $\Gamma \cup \Gamma'' \subseteq \Gamma \cup
    \Gamma'$, implying $\Gamma'' \subseteq \Gamma'$. Therefore, $s' \preceq s$.
    
  \item Case $\matchprimerule$.

    \[
      \begin{prooftree}
        \justifies
        \relj{
          \bactrel{\btriseq{\Gamma}{\Delta}{\cdot}{Q}}
        }{
          \bneuseq{\Gamma'}{\Delta'}{\cdot}
        }{
          \bneuseq{\Gamma, \Gamma'}{\Delta, \Delta'}{Q}
        }
        \using{\matchprimerule}
      \end{prooftree}
    \]

    Suppose $\Sigma' \preceq \Sigma$ such that
    $\relj{\factrel{\btriseq{\Gamma}{\Delta}{Q}{\cdot}} }{ \Sigma' }{ s'
    }$. Then, it must have been an application of the $\matchrule$ rule such that:
    
    \[
      \begin{prooftree}
        \justifies
        \relj{
          \factrel{\btriseq{\Gamma}{\Delta}{\cdot}{Q}}
        }{
          \fneuseq{\Gamma, \Gamma''}{\Delta, \Delta''}{Q}
        }{
          \fneuseq{\Gamma''}{\Delta''}{\cdot}
        }
        \using{\matchrule}
      \end{prooftree}
    \]

    The rest is as in the $\matchrule$ case.
  \end{enumerate}
\end{proof}

\begin{theorem}[Completeness]
  If $\bneuseq{\Gamma}{\Delta}{Q}$, then $\fneuseq{\Gamma'}{\Delta}{Q}$ for some
  $\Gamma' \subseteq \Gamma$.
\end{theorem}
\begin{proof}
  Induction on the derivation of $\bneuseq{\Gamma}{\Delta}{Q}$ and
  Lemma~\ref{fdercompllemma}.
\end{proof}

\section{Focused inverse method}

The primary issue in the forward direction is to enumerate the propositions for
which we need to derive inference rules. As the calculus of derived rules has
only neutral sequents as premises and conclusions, we need only generate rules
for propositions that occur in neutral sequents; we call them \emph{frontier
  propositions}. To find the frontier propositions in a goal sequent, we
abstractly replay the focusing and active phases to identify the phase
transitions. Each transition from an active to a focal phase produces a frontier
proposition.

\[
  \decminus{f(p)} = \emptyset \qquad
  \decplus{f(p)} = \decplusminus{a(p)} = \{
  \decplusminus{\declinear{p}} \} \qquad \text{if $p$ right-based}
\]
\[
  \decplus{f(p)} = \emptyset \qquad
  \decminus{f(p)} = \decminusplus{a(p)} = \{
  \decminusplus{\declinear{p}} \} \qquad \text{if $p$ left-biased}
\]
\[
  \decminus{f(A \otimes B)} = \decminus{a(A \otimes B)} \qquad
  \decplus{f(A \otimes B)} = \decplus{f(A)}, \decplus{f(B)}
\]
\[
  \decminus{a(A\otimes B)} = \decminus{a(A)}, \decminus{a(B)} \qquad
  \decplus{a(A\otimes B)} = \decplus{f(A \otimes B)}, \decminuslinear{(A \otimes B)}
\]
\[
  \decminus{f(A \limp B)} = \decplus{f(A)}, \decminus{f(B)} \qquad
  \decplus{f(A \limp B)} = \decplus{a(A \limp B)}
\]
\[
  \decminus{a(A \limp B)} = \decminus{f(A \limp B)}, \decminuslinear{(A \limp
    B)}
  \qquad
  \decplus{a(A\limp B)} = \decminus{a(A)}, \decplus{a(B)}
\]

\begin{example}
  Put example here...
\end{example}

\begin{definition}[Frontier]
  Given a goal $\Gamma;\Delta \Longrightarrow Q$, its frontier contains

  \begin{enumerate}
  \item All top-level propositions in $\decunrestr{\decminus{\Gamma}},
    \decminuslinear{\Delta}$, and $\decpluslinear{Q}$;
  \item For any $A \in \Gamma, \Delta$, the collection $\decminus{f(A)}$;
  \item the collection $\decplus{f(Q)}$.
  \end{enumerate}
\end{definition}

In the preparatory phase for the inverse method, we calculate the frontier
propositions of the goal sequent. There is no need to generate initial sequents
separately, as the executions of (TODO: thesis says negative. why only
negative??) atoms in the frontier directly give us the necessary initial
sequents.

We that we do not consider negative left-biased atoms (or positive right-biased
atoms) when constructing derived rules from the formulas in the
frontier. Suppose we picked a negative left-biased atom $p$ from the frontier
and tried to build the associated derived rule. This amounts to finding a
derivation for $\relj{\flfrel{p}}{\Sigma}{s}$, which can only happen with an
application of the $conj^-$ rule:

\[
  \begin{prooftree}
    \fneuseq{\Gamma}{\Delta, p}{Q} \quad
    \[
      p \text{ left-biased}
      \justifies
      \flfrelj{p}{\fneuseq{\Gamma}{\Delta, p}{Q}}{\fneuseq{\Gamma}{\Delta}{Q}}
      \using{conj^-}
    \]
    \justifies
    \fneuseq{\Gamma}{\Delta, P}{Q}
    \using{\focminusrule}
  \end{prooftree}
\]

This leads to the following derived rule

\[
  \begin{prooftree}
    \fneuseq{\Gamma}{\Delta, p}{Q}
    \justifies
    \fneuseq{\Gamma}{\Delta, p}{Q}
  \end{prooftree}
\]

which is obviously redundant. The same happens if we tried to build a rule for a
positive right-biased atom. Nevertheless, the $conj^+$ and $conj^-$ rules are
essential to achieve completeness, as also shown by the example below.

\begin{example}
  Example... where $d$ is right-biased and all other atoms are left-biased, and
  $\Gamma \equiv R_1, R_2$.

  \[
    \begin{prooftree}
      \[
        \[ q \text{ left-biased} \justifies \rfocseq{\Gamma}{q}{q}\]
        \[
          \[
            \[
              \[
                \[
                  \[
                    \[
                      \[ d \text{ right-biased} \justifies \lfocseq{\Gamma}{\cdot}{d}{d} \]
                      \justifies
                      \btriseq{\Gamma}{d}{\cdot}{\cdot ; d}
                    \]
                    \justifies
                    \rfocseq{\Gamma}{d}{d}
                  \]
                  \[
                    \[
                      \[ d \text{ right-biased} \justifies \lfocseq{\Gamma}{\cdot}{d}{d} \]
                      \justifies
                      \btriseq{\Gamma}{d}{\cdot}{\cdot ; d}
                    \]
                    \justifies
                    \rfocseq{\Gamma}{d}{d}
                  \]
                  \justifies
                  \rfocseq{\Gamma}{d,d}{d \otimes d}
                \]
                \[
                  \[
                    \[
                      \[
                        \[ n \text{ left-biased} \justifies \rfocseq{\Gamma}{n}{n}\]
                        \[ n \text{ left-biased} \justifies \rfocseq{\Gamma}{n}{n}\]
                        \justifies
                        \rfocseq{\Gamma}{n,n}{n \otimes n}
                      \]
                      \[
                        d \text{ right-biased}
                        \justifies
                        \lfocseq{\Gamma}{\cdot}{d}{d}
                      \]
                      \justifies
                      \lfocseq{\Gamma}{n,n}{n \otimes n \limp d}{d}
                    \]
                    \justifies
                    \btriseq{\Gamma}{n,n}{\cdot}{\cdot ; d}
                    \using{\copyrule}
                  \]
                  \justifies
                  \rfocseq{\Gamma}{n,n}{d}
                \]
                \justifies
                \rfocseq{\Gamma}{n,d,d,n}{d \otimes d \otimes d}
              \]
              \justifies
              \btriseq{\Gamma}{n, d, d, n}{\cdot}{\cdot ; d \otimes d \otimes d}
              \using{\rfoc}
            \]
            \justifies
            \btriseq{\Gamma}{n}{d \otimes d \otimes n}{\cdot ; d \otimes d \otimes d}
            \using{\otimes L \times 3, \lact \times 3}
          \]
          \justifies
          \lfocseq{\Gamma}{n}{d \otimes d \otimes n}{d \otimes d \otimes d}
          \using{\lblur}
        \]
        \justifies
        \lfocseq{\Gamma}{q,n}{q \limp d \otimes d \otimes n}{d \otimes d \otimes d}
        \using{\limp L}
      \]
      \justifies
      \btriseq{\Gamma}{q,n}{\cdot}{\cdot ; d \otimes d \otimes d}
      \using{\copyrule}
    \end{prooftree}
  \]
\end{example}

The frontier of the full goal sequent

\[
  \fneuseq{q \limp d\otimes d\otimes n, n \otimes n \limp d}{q,n}{d \otimes d
    \otimes d}
\]

is given by the top-level decorations

\[
  \decminusunrestr{(q \limp d \otimes d \otimes n)},
  \decminusunrestr{(n \otimes n \limp d)},
  \decminuslinear{q}, \decminuslinear{n},
  \decpluslinear{(d \otimes d \otimes d)}
\]

together with the additionally computed subformulas
$\decminuslinear{d}, \decminuslinear{n}, \decpluslinear{d}$. The frontier
formulas give rise to the initial derived rules as follows

\begin{itemize}
\item $\decminuslinear{q}$ is a negative left-biased atom, hence it is ignored;
  same for $\decminuslinear{n}$;
\item $\decminuslinear{d}$ is a negative right-biased atom, hence we get an
  initial sequent as follows:

  \[
    \begin{prooftree}
      \[
        d \; \text{right-based}
        \justifies
        \relj{\flfrel{d}}{\cdot}{\fneuseq{\cdot}{\cdot}{d}}
        \using{\linit}
      \]
      \justifies
      \fneuseq{\cdot}{d}{d}
      \using{\focminusrule}
    \end{prooftree}
  \]

\item $\decpluslinear{d}$ is a positive right-biased atom, hence it is ignored;

\item The negative unrestricted formula $q \limp d \otimes d \otimes d$ gives
  rise to a derived rule as follows

  {
    \scriptsize{
      \[
        \begin{prooftree}
          \fneuseq{\Gamma}{\Delta, d, d, n}{Q}
          \[
            \[
              \[
                \[
                  \justifies
                  \factrelj{
                    \btriseq{\cdot}{d,d,n}{\cdot}{\cdot}
                  }{
                    \fneuseq{\Gamma}{\Delta,d,d,n}{Q}
                  }{
                    \fneuseq{\Gamma}{\Delta}{Q}
                  }
                \]
                \justifies
                \factrelj{
                  \btriseq{\cdot}{\cdot}{d \otimes d \otimes n}{\cdot}
                }{
                  \fneuseq{\Gamma}{\Delta,d,d,n}{Q}
                }{
                  \fneuseq{\Gamma}{\Delta}{Q}
                }
              \]
              \justifies
              \flfrelj{d \otimes d \otimes n}{\fneuseq{\Gamma}{\Delta,d,d,n}{Q}}{\fneuseq{\Gamma}{\Delta}{Q}}
            \]
            \[
              q \text{ left-biased}
              \justifies
              \frfrelj{q}{\cdot}{\fneuseq{\cdot}{q}{\cdot}}
            \]
            \justifies
            \flfrelj{q \limp d \otimes d \otimes
              d}{\fneuseq{\Gamma}{\Delta,d,d,n}{Q}}{\fneuseq{\Gamma}{\Delta,q}{Q}}
          \]
          \justifies
          \fneuseq{\Gamma, R_3}{\Delta, q}{Q}
        \end{prooftree}
      \]
    }
  }

  that is

  \[
    \begin{prooftree}
      \fneuseq{\Gamma}{\Delta, d, d, n}{Q}      
      \justifies
      \fneuseq{\Gamma, R_3}{\Delta, q}{Q}
    \end{prooftree}
  \]

\item The negative unrestricted formula $n \otimes n \limp d$ gives rise to a
  derived rule as follows

  \[
    \begin{prooftree}
      \[
        \[
          \[
            n \text{ left-biased}
            \justifies
            \frfrelj{n}{\cdot}{\fneuseq{\cdot}{n}{\cdot}}
          \]
          \[
            n \text{ left-biased}
            \justifies
            \frfrelj{n}{\cdot}{\fneuseq{\cdot}{n}{\cdot}}
          \]
          \justifies
          \frfrelj{n \otimes n}{\cdot}{\fneuseq{\cdot}{n,n}{\cdot}}
        \]
        \[
          d \text{ right-biased}
          \justifies
          \flfrelj{d}{\cdot}{\fneuseq{\cdot}{\cdot}{d}}
        \]
        \justifies
        \flfrelj{n \otimes n \limp d}{\cdot}{\fneuseq{\cdot}{n,n}{d}}
      \]
      \justifies
      \fneuseq{R_1}{n,n}{d}
    \end{prooftree}
  \]

  that is

  \[
    \begin{prooftree}
      \justifies
      \fneuseq{R_1}{n,n}{d}
    \end{prooftree}
  \]

\item The positive linear formula $d \otimes d \otimes d$ gives rise to a
  derived rule as follows

  \[
    \begin{prooftree}
      \[
        \[
          d \text{ right-biased}
          \justifies
          \frfrelj{d}{s_1}{\fneuseq{\Gamma_1}{\Delta_1}{\cdot}}
        \]
        \[
          d \text{ right-biased}
          \justifies
          \frfrelj{d}{s_2}{\fneuseq{\Gamma_2}{\Delta_2}{\cdot}}
        \]
        \justifies
        \frfrelj{d \otimes d
        }{
          s_1 \cdot s_2
        }{
          \fneuseq{\Gamma_1,\Gamma_2}{\Delta_1,\Delta_2}{\cdot}
        }
      \]
      \[
        d \text{ right-biased}
        \justifies
        \frfrelj{d}{s_3}{\fneuseq{\Gamma_3}{\Delta_3}{\cdot}}
      \]
      \justifies
      \frfrelj{d \otimes d \otimes d}{s_1 \cdot s_2 \cdot s_3
      }{
        \fneuseq{\Gamma_1, \Gamma_2, \Gamma_3}{\Delta_1, \Delta_2, \Delta_3}{\cdot}
      }
    \end{prooftree}
  \]

  where $s_i \equiv \fneuseq{\Gamma_i}{\Delta_i}{d}$. Therefore

  \[
    \begin{prooftree}
      \fneuseq{\Gamma_1}{\Delta_1}{d}
      \quad
      \fneuseq{\Gamma_2}{\Delta_2}{d}
      \quad
      \fneuseq{\Gamma_3}{\Delta_3}{d}
      \justifies
      \fneuseq{\Gamma_1, \Gamma_2, \Gamma_3}{\Delta_1, \Delta_2, \Delta_3}{d
        \otimes d \otimes d}
    \end{prooftree}
  \]

\end{itemize}

Then, the goal sequent can be derived as follows:

\[
  \begin{prooftree}
    \[
      \[
        \justifies
        \fneuseq{\cdot}{d}{d}
      \]
      \[
        \justifies
        \fneuseq{\cdot}{d}{d}
      \]
      \[
        \justifies
        \fneuseq{R_1}{n,n}{d}
      \]
      \justifies
      \fneuseq{R_1}{d,d,n,n}{d \otimes d \otimes d}
    \]
    \justifies
    \fneuseq{R_1, R_3}{q,n}{d \otimes d \otimes d}
  \end{prooftree}
\]

\section{Search strategy}

\subsection{Sequent representation}

% Taken from 4.1.1 of the thesis, and adapted to forward neutral sequents.

The subformula property gives us the core of the inverse method procedure. We
start with initial sequents of the form $\fneuseq{\cdot}{p}{p}$, where the atom
$p$ occurs as both a positive and a negative subformula of the decorated goal
sequent. Since we need some way to refer to subformulas of the goal sequent, we
label all subformulas with new fresh labels.
We write $l \# A$ to denote that $l$ is the label for the formula
$A$. Given a goal sequent $\fneuseq{\Gamma}{\Delta}{Q}$, we define
the following top-level labels: $\labels{u_i}{A_i}$, $\labels{l_j}{B_j}$ and
$\labels{r}{Q}$. Furthermore, we label every non-atomic subformula of the
sequent using a unique label. During inference, we refer to labelled sequents
only. Hence, all derived and partially applied rules refer to labelled sequents.

Represented sequents consist of a collection of labels of resources and the
label of the goal. The labels of the unrestricted context are organized in a
set, whereas the labels of the linear context are organized in a binary map
between labels and their multiplicities.

\begin{definition}[Represented sequent]
  A forward sequent is represented as follows:

  \[
    u_1 \# A_1, \dots, u_m \# A_n ; l_1^{k_1} \# B_1, \dots, l_n^{k_n} \# B_k
    \fneuseqsymb r \# Q
  \]
\end{definition}

\subsection{Subsumption}

In the saturation-based search that we use in the forward direction, there is a
form of non-determinism in selecting sequents for applying rules. It is
therefore important that the database of sequents available as candidates is as
less redundant as possible. We therefore need to check for \emph{sequent
  subsumption} whenever a new sequent is created (\emph{forward
  subsumption}). In implementing subsumption checks, it is important to detect
failures as early as possible, because the vast majority of checks it likely to
fail. The usual strategy is to perform a sequence of hierarchical tests that
imply subsumption if they all succeed. Performing these checks in sequence
allows us to stop as soon as one of them fails.

\begin{definition}[Hierarchical subsumption tests]
  A forward sequent $s_1 \equiv \Gamma; \Delta \longrightarrow C$ does not
  subsume $s_2 \equiv \Gamma'; \Delta' \longrightarrow C'$, if

  \begin{enumerate}
  \item $C \neq C'$, or
  \item $\Delta \not \subseteq \Delta'$, or
  \item $\Gamma \not \subseteq \Gamma'$, or
  \item $s_1 \not \prec s_2$.
  \end{enumerate}

  Where $C = C'$ compares both formulas and labels, $\Gamma \subseteq \Gamma'$
  if for every $l \in \mathrm{dom}(\Gamma)$,
  $\mathrm{mult}(\Gamma, l) \leq \mathrm{mult}(\Gamma', l)$, and similarly for
  $\Delta$.
\end{definition}

It is trivial to verify that a sequent subsumes another sequent if and only if
the subsumption test above fails.

\subsection{Rules and rule application}

% % From 4.1.5
% Rules are precomputed to the specific labels of the subformulas of the goal
% sequent. If the positive proposition $\labels{r}{A \otimes B}$ occurs in the
% goal sequent, and $\labels{r_A}{A}, \labels{r_B}{B}$ are the labels of the
% operands, then the following rule will be generated for this label:

% \[
%   \begin{prooftree}
%     \Gamma_1; \Delta_1 \longrightarrow r_A
%     \qquad
%     \Gamma_2; \Delta_2 \longrightarrow r_B
%     \justifies
%     \Gamma_1, \Gamma_2; \Delta_1, \Delta_2 \rightarrow r
%     \using{\otimes R}
%   \end{prooftree}
% \]

% To apply a rule to a given input sequent, we have to first \emph{match} a
% premiss of the rule to the input sequent.

Derived rules are precomputed to specific frontier subformulas, or rather, to
the labels associated to frontier subformulas. Derived rules can be applied to
input sequents in different ways, as long as the input sequents satisfy the
sufficient requirements in order to be used with that rule. That is, to apply a
rule to an input sequent, we have to first \emph{match} a premise of the rule to
the input sequent. We formalize this in a notion of \emph{sequent schema}.

\begin{definition}[Sequent schema]
  A sequent schema is of the form

  \[
    u_1, \dots, u_m ; l_1^{k_1}, \cdot, l_n^{k_n} \fneuseqsymb \gamma
  \]

  where $\gamma$ is either a label $r$ or $\cdot$.
\end{definition}

\begin{definition}[Matching]
  We say that a schema $\sigma = \fneuseq{\Gamma_s}{\Delta_s}{\gamma_s}$ matches
  an input sequent $s = \fneuseq{\Gamma}{\Delta}{r}$ if

  \begin{enumerate}
  \item $\Gamma_s \subseteq \Gamma$;
  \item $\Delta_s \subseteq \Delta$;
  \item $\gamma_s \subseteq r$.
  \end{enumerate}
\end{definition}
\begin{definition}[Match result]
  A result of the match, written $\sigma | s$, is a sequent-like structure
  $\fneuseq{\Gamma_r}{\Delta_r}{\gamma_r}$, for which
  
  \begin{enumerate}
  \item $\Gamma_r = \Gamma \setminus \Gamma_s$;
  \item $\Delta_r = \Delta \setminus \Delta_s$;
  \item $\gamma_r =
    \begin{cases}
      \cdot, & \text{if } \gamma_s = r \\
      r,     & \text{if } \gamma_s = \cdot
    \end{cases}$
    % \item Like this in the thesis: $\gamma_r = \gamma$.
  \end{enumerate}
\end{definition}

\begin{example}
  Suppose we are deriving the rule associated to the formula $q \limp d \otimes
  d \otimes n$.

  {
    \scriptsize{
      \[
        \begin{prooftree}
          \[
            \[
              \justifies
              \factrelj{\btriseq{\cdot}{\cdot}{\cdot}{q}}{s_1}{\fneuseq{\Gamma_1}{\Delta_1}{\cdot}}
            \]
            \justifies
            \frfrelj{q}{s_1}{\fneuseq{\Gamma_1}{\Delta_1}{\cdot}}
          \]
          \qquad
          \[
            \[
              \[
                \justifies
                \factrelj{\btriseq{\cdot}{d,d,n}{\cdot}{\cdot}}{s_2}{\fneuseq{\Gamma_2}{\Delta_2}{\gamma}}
              \]
              \justifies
              \factrelj{\btriseq{\cdot}{\cdot}{d \otimes d \otimes n}{\cdot}}{s_2}{\fneuseq{\Gamma_2}{\Delta_2}{\gamma}}
            \]
            \justifies
            \flfrelj{d \otimes d \otimes n}{s_2}{\fneuseq{\Gamma_2}{\Delta_2}{\gamma}}
          \]
          \justifies
          \flfrelj{q \limp d \otimes d \otimes d}{s_1 \cdot s_2}{
            \fneuseq{\Gamma_1, \Gamma_2}{\Delta_1, \Delta_2}{\gamma}
          }
        \end{prooftree}
      \]
    }
  }

  The above derivation tells us that $s_1$ is required to have $q$ as conclusion
  formula. Morover, $s_2$ is required to include $d, d, n$ in its linear
  context. The goal $\gamma$ of the second premise sequent becomes the goal of
  the conclusion sequent of the derived rule, whatever that is. All this can be
  expressed in terms of sequent schemas, by saying that the premises of the
  above rule must be matched agains the two schemas

  \[
    \fneuseq{\cdot}{\cdot}{q}
  \]
  \[
    \fneuseq{\cdot}{d,d,n}{\cdot}
  \]

  Given the following results of matching $s_1$ and $s_2$ against the schemas

  \[
    \fneuseq{\Gamma_1}{\Delta_1}{\cdot}
  \]
  \[
    \fneuseq{\Gamma_2}{\Delta_2}{r}
  \]

  These are assembled to form the conclusion sequent of the entire rule, that is

  \[
    \fneuseq{\Gamma_1, \Gamma_2}{\Delta_1, \Delta_2}{r}
  \]

\end{example}

\subsection{Search procedure}

% From 4.1.6

The search procedure is summarized as follows:

\begin{enumerate}
\item Label all subformulas of the goal sequent, and decorate using signs and
  availabilities;
\item Determine all initial sequents for atomic formulas with both signs;
\item Specialize all left rules for negative subformulas, all right rules for
  positive subformulas, and instances of the ``copy'' rule for unrestriced
  subformulas;
\item Starting from the initial sequents, apply the inference ruels in any order
  that is guaranteed to saturate the search space. Add new facts to a database
  used for forward subsumption;
\item Stop when the goal sequent is matched, or if no rules apply.
\end{enumerate}

The procedure maintains two continually updated sequent databases:

\begin{enumerate}
\item The \strong{kept sequents} database contains new sequents that have not
  been subsumed, but are not yet being considered for rule applications;
\item The \strong{active sequents} database that contains all sequents that
  should be considered for rule applications.
\end{enumerate}

At each loop iteration, a sequent $s$ is selected and removed from the kept
sequents database and inserted into the active sequents database
(``activation''). Then, all specialized rules are matched against $s$ as the
first premise.... [continues, but does not say anything]

Completeness of the loop is a well known property, requiring only the following
properties of the implementation:

\begin{enumerate}
\item \strong{Fair selection}: every sequent in the kept sequents database is
  eventually selected for insertion into the active sequents database;
\item \strong{Fair application}: if a rule can be fully satisfied by sequents in
  the active sequents database (in any order), then the conclusion of this rule
  is eventually considered for insertion into the kept sequents database.
\end{enumerate}

\subsection{Search procedure 2}

% Taken from 5.6

We extend the approach by treating all rules as essentially unary rules that
produce either a conclusion sequent or a partially instantiated rule. Hence we
have a dynamically growing collection of (partially applied) rules in the rule
database.

The inner (?) loop of the search procedure performs the following \emph{lazy
  activation} step until either the goal sequent is subsumed, or no further
rules are applicable to the active sequents. Activation contains a closely
related procedure called \emph{percolation}.

\begin{definition}[Lazy activation]
  In the activation of a sequent $s$, that is, the transferring of $s$ from the
  kept sequents database to the active sequents database, the following steps
  are performed:

  \begin{enumerate}
  \item The sequent is renamed (???) and inserted into the active sequents
    database;
  \item All available rules are applied to $s$. If these applications produced
    new rules $R$, then percolation is performed on $R$ to obtain the full
    collection of new partially instantiated rules;
  \item The new rules are added to the rule database;
  \item All sequents generated during the above rule applications and
    percolation are tested for subsumption in the global index (forward
    subsumption). All unsubsumed sequents are added to the kept sequents
    database.
  \end{enumerate}
\end{definition}

\begin{definition}[Percolation]
  To percolate a collection of rules $R$, the following two steps are performed
  until there are no new additions to $R$:

  \begin{enumerate}
  \item For every sequent in the active set, every rule in $R$ is applied to it;
  \item Any new rules generated are added to $R$.
  \end{enumerate}
\end{definition}

A sequent is added to the kept sequents database if it is not globally subsumed
by some sequent derived earlier.

\subsection{The focused inverse method (to be redistributed)}

% Taken from 6.3

It is possible for a new sequent to be stronger than some sequents already in
the database. In this case, the old weaker sequents are no longer considered for
new derivations (backward subsumption).

\subsubsection{Implementation details}

% Taken from 6.3.1

Given a proposition in the frontier, the focusing phase of the derived rule for
it is completely predictable, sincere there are no disjunctive choices to be
made. The active phase is also predictable, since we do not have additive
connectives.

My addition: Hence, every subformula in the frontier deterministically gives
rise to a unique derived rule schema (which can of course be matched by actual
premise sequents in infinite ways).

Doubt: perche' parla di proposizioni e non di (sotto-)formule? Non avevamo detto
che ogni non-atomic subformula e` distinta da altre subformule relative alla
stessa proposizione (quindi sintatticamente uguali nel caso proposizionale).

\subsection{Search loop}

% taken from "A focusing inverse method theorem prover for first-order
% linear logic"

We use a lazy variant of the OTTER loop as the main loop of the search
procedure. We maintain tow global sets of derived sequents:

\begin{itemize}
\item The \emph{active set} containing sequents to be considered as premises of
  rules;
\item The \emph{inactive set} that contains all facts that have not yet been
  transferred to the active set.
\end{itemize}

The inner loop of the search procedure repeats the following lazy activation
step until either the goal sequent is subsumed (in which case the search is
successful), or no further rules are applicable to the sequents in the acitve
set and the inactive set is exhausted (in which case the search saturates).

\begin{definition}[Lazy activation]
  To activate the sequent $s$, i.e., to transfer it from the inactive to the
  active set, the following steps are performed:

  \begin{enumerate}
  \item After renaming (???), $s$ is inserted into the active set;
  \item All available rules are applied to $s$. If these applications produce
    new rules, say a set $R$, then the following two steps are performed in a
    loop until there are no additions to $R$:

    \begin{enumerate}
    \item For every sequent $s'$ in the active set, every rule in $R$ is applied
      to $s'$;
    \item any new rules generated are added to $R$.
    \end{enumerate}

    This two-steps inner loop is called the \emph{percolation} phase.
  \item The collection of rules $R$ is added to the set of rules;
  \item All sequents generated during the above applications are tested for
    subsumption, and the un-subsumed sequents are added to the inactive set.
  \end{enumerate}
\end{definition}

\begin{theorem}[Completeness of the search loop]
  Let $S_a, S_i$ be the active and inactive sets and $R$ the collection of rules
  of the search procedure before initiating iteration $i$. Suppose $r$ is a rule
  in $R$ and $s_1, s_2, \dots, s_n$ is an ordered list of sequents from
  $S_a \cup S_i$ that would, if matched agains $r$ in this order, produce a
  successful result. Then this match actually occurs, and the result of it added
  to the state of the search, during some iteration $j \geq i$.
\end{theorem}
\begin{proof}
  By induction on $n$. If $n = 0$, then the match occurs vacuously during any
  iteration from $i$ on. If the list is instead $n+1$ elements long, then
  clearly the first $n$ sequents in the list potentially match $r$ successfully,
  and by inductive hypothesis they are eventually matched agains $r$ producing a
  partially applied rule $r'$ during some iteration $j \geq i$. We split cases
  depending on whether $s_{n+1} \in S_a$ or $s_{n+1} \in S_i$ during such
  iteration $j$.

  \begin{itemize}
  \item If $s_{n+1} \in S_a$ during iteration $j$ (whether because it is added
    at the beginning of it or because it is in $S_a$ already), then the
    percolation phase ensures that $r'$ is also matched against
    $s_{n+1}$. Therefore, $r$ is fully applied to $s_1, \dots, s_{n+1}$ during
    iteration $j$, where $j \geq i$ by hypothesis;
    
  \item If $s_{n+1} \in S_i$ during iteration $j$, then $s_{n+1}$ is eventually
    selected for activation during some iteration $k > j$ and matched against
    all rules in the collection of rules at that moment. From the inductive
    hypothesis it follows that $r'$ is added in the collection of rules during
    iteration $j$, so it certainly is in this collection during iteration
    $k$. Therefore, $r'$ is matched agains $s_{n+1}$ during some iteration
    $k \geq i$, hence producing the result of matching $r$ against
    $s_1, \dots, s_{n+1}$ during such iteration.
  \end{itemize}
\end{proof}

% \include{implementation}

\section{Proof terms}

\subsection{Natural deduction}

\begin{figure}[H]
  \begin{mdframed}

    \[
      \begin{prooftree}
        \justifies
        \Gamma ; \tyj{u}{A} \vdash \tyj{u}{A}
        \using{hyp}
      \end{prooftree}
      \qquad \qquad
      \begin{prooftree}
        \justifies
        \Gamma, \tyj{u}{A} ; \cdot \vdash \tyj{u}{A}
        \using{hyp!}
      \end{prooftree}
    \]

    \[
      \begin{prooftree}
        \Gamma, \Delta_1 \vdash \tyj{M}{A}
        \qquad
        \Gamma, \Delta_2 \vdash \tyj{N}{B}
        \justifies
        \Gamma, \Delta_1, \Delta_2 \vdash \tyj{\langle M, N \rangle}{A \otimes B}
        \using{\otimes I}
      \end{prooftree}
    \]

    \[
      \begin{prooftree}
        \Gamma, \Delta_1 \vdash \tyj{M}{A \otimes B}
        \qquad
        \Gamma, \Delta_2, \tyj{u}{A}, \tyj{v}{B} \vdash \tyj{N}{C}
        \justifies
        \Gamma, \Delta_1, \Delta_2 \vdash \tyj{(\textsf{let }\langle u,v \rangle = M \textsf{
            in } N)}{C}
        \using{\otimes E}
      \end{prooftree}
    \]

    \[
      \begin{prooftree}
        \Gamma ; \Delta, \tyj{u}{A} \vdash \tyj{M}{B}
        \justifies
        \Gamma ; \Delta \vdash \tyj{\lambda u . M}{A \limp B}
        \using{\limp I}
      \end{prooftree}
      \qquad
      \begin{prooftree}
        \Gamma ; \Delta \vdash \tyj{M}{A \limp B}
        \qquad
        \Gamma ; \Delta' \vdash \tyj{N}{A}
        \justifies
        \Gamma ; \Delta, \Delta' \vdash \tyj{M\ N}{B}
        \using{\limp E}
      \end{prooftree}
    \]
  \end{mdframed}
  \caption{Natural deduction calculus}
  \label{fig:dertermrules}
\end{figure}

\begin{definition}[Free variables]
  The set $FV(M)$ of free variables of a natural deduction proof term $M$ is
  inductively defined as follows:

  \begin{align*}
    FV(u) & \equiv \{ u \} \\
    FV(\langle M, N \rangle) & \equiv FV(M) \cup FV(N) \\
    FV(\textsf{let }\langle u,v \rangle = M \textsf{ in } N) & \equiv FV(M) \cup (FV(N) \setminus \{ u, v \}) \\
    FV(\lambda u . M) & \equiv FV(M) \setminus \{ u \} \\
    FV(M\ N) & \equiv FV(M) \cup FV(N)
  \end{align*}
\end{definition}

\begin{lemma}
  If $\Gamma ; \Delta \vdash \tyj{M}{A}$, then
  $FV(M) \subseteq FV(\Gamma, \Delta)$.
\end{lemma}
\begin{proof}
  Straightforward induction on the derivations.
\end{proof}

\begin{lemma}[Admissibility of weakening]
  The following rule of weakening is admissible.

  \[
    \begin{prooftree}
      \Gamma ; \Delta \vdash \tyj{M}{A}
      \justifies
      \Gamma, \tyj{u}{B} ; \Delta \vdash \tyj{M}{A}
    \end{prooftree}
  \]
\end{lemma}
\begin{proof}
  Straightforward induction on the derivations.
\end{proof}

\begin{lemma}[Admissibility of copy]
  The following copy rule is admissible.

  \[
    \begin{prooftree}
      \Gamma, \tyj{u}{A} ; \Delta, \tyj{v}{A} \vdash \tyj{M}{B}
      \justifies
      \Gamma, \tyj{u}{A} ; \Delta \vdash \tyj{M[u/v]}{B}
    \end{prooftree}
  \]
\end{lemma}
\begin{proof}
  By induction on the derivation.

  \begin{enumerate}
  \item Case $hyp$

    \[
      \begin{prooftree}
        \justifies
        \Gamma, \tyj{u}{A} ; \tyj{v}{A} \vdash \tyj{v}{A}
        \using{hyp}
      \end{prooftree}
    \]

    Then

    \[
      \begin{prooftree}
        \justifies
        \Gamma, \tyj{u}{A} ; \cdot \vdash \tyj{v[u/v] \equiv u}{A}
        \using{hyp!}
      \end{prooftree}
    \]
    
  \item Case $\otimes I$. Suppose $\tyj{v}{A}$ comes from the first branch (the
    other case is identical):

    \[
      \begin{prooftree}
        \Gamma, \tyj{u}{A}; \Delta_1, \tyj{v}{A} \vdash \tyj{M}{A}
        \qquad
        \Gamma, \tyj{u}{A}; \Delta_2 \vdash \tyj{N}{B}
        \justifies
        \Gamma, \tyj{u}{A} ; \Delta_1, \Delta_2, \tyj{v}{A} \vdash \tyj{\langle
          M, N \rangle}{A \otimes B}
        \using{\otimes I}
      \end{prooftree}
    \]

    By Lemma, $N$ does not contain $v$ free, hence $N[u/v] \equiv N$. Then, by
    inductive hypothesis

    \[
      \begin{prooftree}
        \Gamma, \tyj{u}{A}; \Delta_1 \vdash \tyj{M[u/v]}{A}
        \qquad
        \Gamma, \tyj{u}{A}; \Delta_2 \vdash \tyj{N[u/v]}{B}
        \justifies
        \Gamma, \tyj{u}{A} ; \Delta_1, \Delta_2 \vdash \tyj{\langle
          M[u/v], N[u/v] \rangle}{A \otimes B}
        \using{\otimes I}
      \end{prooftree}
    \]

    but $\langle M[u/v], N[u/v] \rangle \equiv \langle M,N \rangle [u/v]$.
    
  \item Case $\otimes E$. Suppose $\tyj{v}{A}$ comes from the second premise
    (the other case is identical).

    \[
      \begin{prooftree}
        \Gamma, \tyj{u}{A}; \Delta_1 \vdash \tyj{M}{B \otimes C}
        \qquad
        \Gamma, \tyj{u}{A}; \Delta_2,, \tyj{v}{A}, \tyj{w_1}{B}, \tyj{w_2}{C} \vdash \tyj{N}{D}
        \justifies
        \Gamma, \tyj{u}{A}; \Delta_1, \Delta_2, \tyj{v}{A} \vdash
           \tyj{(\textsf{let }\langle w_1,w_2 \rangle = M \textsf{ in } N)}{D}
        \using{\otimes E}
      \end{prooftree}
    \]

    Again, $M$ does not contain $v$ free by Lemma, hence $M[u/v] \equiv M$. But
    then, by inductive hypothesis
    
    \[
      \begin{prooftree}
        \Gamma, \tyj{u}{A}; \Delta_1 \vdash \tyj{M[u/v]}{B \otimes C}
        \qquad
        \Gamma, \tyj{u}{A}; \Delta_2, tyj{w_1}{B}, \tyj{w_2}{C} \vdash \tyj{N[u/v]}{D}
        \justifies
        \Gamma, \tyj{u}{A}; \Delta_1, \Delta_2, \tyj{v}{A} \vdash
           \tyj{(\textsf{let }\langle w_1,w_2 \rangle = M[u/v] \textsf{ in } N[u/v])}{D}
        \using{\otimes E}
      \end{prooftree}
    \]

    where $\textsf{let }\langle w_1,w_2 \rangle = M[u/v] \textsf{ in } N[u/v]$
    is precisely $(\textsf{let }\langle w_1,w_2 \rangle = M \textsf{ in }
    N)[u/v]$ as long as $w_1, w_2$ do not capture $u$, that is, as long as they
    are different. But they are, since they appear in the same context in the
    second premise.
    
  \item Case $\limp I$.
    
    \[
      \begin{prooftree}
        \Gamma, \tyj{u}{A} ; \Delta, \tyj{v}{A}, \tyj{w}{B} \vdash \tyj{M}{C}
        \justifies
        \Gamma, \tyj{u}{A} ; \Delta, \tyj{v}{A} \vdash \tyj{\lambda w . M}{B \limp C}
        \using{\limp I}
      \end{prooftree}
    \]

    Then, by inductive hypothesis
    
    \[
      \begin{prooftree}
        \Gamma, \tyj{u}{A} ; \Delta, \tyj{w}{B} \vdash \tyj{M[u/v]}{C}
        \justifies
        \Gamma, \tyj{u}{A} ; \Delta \vdash \tyj{\lambda w . M[u/v]}{B \limp C}
        \using{\limp I}
      \end{prooftree}
    \]

    where $\lambda w . M[u/v] \equiv (\lambda w . M)[u/v]$ as long as $w \not
    \equiv u$, which is true since tey appear in the same context.

  \item Case $\limp E$ is identical to $\otimes I$.
  \end{enumerate}
\end{proof}

Before giving the translation from labelled forward sequent derivation to
natural deduction proof terms, we define some auxiliary functions.


\begin{align*}
  \textsf{common}([] ; \Gamma') & = [] \\
  \textsf{common}(\tyj{x}{A}, \Gamma ; \Gamma')
                                & =
                                  \begin{cases}
                                    (w, x, y, A), \textsf{common}(\Gamma ;
                                    \Gamma')\; (w \text{ fresh}), & \text{if } \tyj{y}{A} \in
                                    \Gamma' \\
                                    \textsf{common}(\Gamma ; \Gamma'), & \text{otherwise}
                                  \end{cases}
\end{align*}

If $C = \textsf{common}(\Gamma ; \Gamma')$, then


% \[
%   C_0 = \{ \tyj{w}{A} \, | \, (w, \_, \_, A) \in C \}
% \]
\[
  C_1 = \{ \tyj{x}{A} \, | \, (\_, x, \_, A) \in C \}
\]
\[
  C_2 = \{ \tyj{y}{A} \, | \, (\_, \_, y, A) \in C \}
\]

A common set $C$ is applied to a deduction $\Gamma ; \Delta \vdash \tyj{M}{A}$
as follows:

\[
  \begin{prooftree}
    \Gamma ; \Delta \vdash \tyj{M}{A}
    \qquad []
    \justifies
    \Gamma ; \Delta \vdash \tyj{M}{A}
    \using{apply _{1/2}}
  \end{prooftree}
\]

\[
  \begin{prooftree}
    \[
      \Gamma ; \Delta \vdash \tyj{M}{A}
      \qquad
      (w, x, y, A), C
      \justifies
      \Gamma[w/x] ; \Delta \vdash \tyj{M[w/x]}{A}
      \using{apply _1}
    \]
    C
    \justifies
    \Gamma ; \Delta \vdash \tyj{M}{A}
    \using{apply _1}
  \end{prooftree}
  \qquad
  \begin{prooftree}
    \[
      \Gamma ; \Delta \vdash \tyj{M}{A}
      \qquad
      (w, x, y, A), C
      \justifies
      \Gamma[w/y] ; \Delta \vdash \tyj{M[w/y]}{A}
      \using{apply _2}
    \]
    C
    \justifies
    \Gamma ; \Delta \vdash \tyj{M}{A}
    \using{apply _2}
  \end{prooftree}
\]

\begin{lemma}
  The following substitution rule is admissible:

  \[
    \begin{prooftree}
      \Gamma ; \Delta_1 \vdash \tyj{M}{A}
      \qquad
      \Gamma ; \Delta_2, \tyj{u}{A} \vdash \tyj{N}{B}
      \justifies
      \Gamma ; \Delta_1, \Delta_2 \vdash \tyj{N[M/u]}{B}
    \end{prooftree}
  \]
\end{lemma}
\begin{proof}
  TODO.
\end{proof}

\begin{theorem}
  Given a labelled forward derivation
  $\seqpt{\mathcal{D}}{\fwdseq{\Gamma}{\Delta}{C}}$ in which every formula
  appears at most once in $\Gamma$, there exists a natural deduction derivation
  $\Gamma ; \Delta \vdash \tyj{M}{C}$ for some $M$.
\end{theorem}
\begin{proof}
  \begin{enumerate}
  \item Case $\init$

    \[
      \begin{prooftree}
        \justifies
        \seqpt{\dtinit{p}}{\fwdseq{\cdot}{\labels{p}{p}}{p}}
      \end{prooftree}
    \]

    Then

    \[
      \begin{prooftree}
        \justifies
        \cdot ; \tyj{u}{p} \vdash \tyj{u}{p}
        \using{hyp}
      \end{prooftree}
    \]

    where $u$ is a fresh variable.
    
  \item Case $\copyrule$.
    
    \[
      \begin{prooftree}
        \seqpt{\mathcal{D}}{
          \fwdseq{\Gamma}{\Delta, \labels{l^{k+1}}{A}}{C}}
        \justifies
        \seqpt{\dtcopy{\mathcal{D}}{l}{A}}{
          \fwdseq{\Gamma \cup \labels{l}{A}}{\Delta, \labels{l^k}{A}}{C}}
      \end{prooftree}
    \]

    By inductive hypothesis, we have
    $\Gamma_n ; \Delta_n, \tyj{v}{A} \vdash \tyj{M}{C}$. Suppose $\Gamma$ does
    not contain labels for $A$, so that $\Gamma_n$ does
    not contain an hypothesis relative to $A$. Then, by weakening and copy:

    \[
      \begin{prooftree}
        \[
          \Gamma_n ; \Delta_n, \tyj{v}{A} \vdash \tyj{M}{C}
          \justifies
          \Gamma_n, \tyj{u}{A} ; \Delta_n, \tyj{v}{A} \vdash \tyj{M}{C}
        \]
        \justifies
        \Gamma_n, \tyj{u}{A} ; \Delta_n \vdash \tyj{M[u/v]}{C}
      \end{prooftree}
    \]

    If $\Gamma$ does contain $A$ then the thesis follows in the same way just by
    a direct application of the copy rule.
    
  \item Case $\otimes R$.

    \[
      \begin{prooftree}
        \seqpt{\mathcal{D}}{\fwdseq{\Gamma}{\Delta}{A}}
        \quad
        \seqpt{\mathcal{D'}}{\fwdseq{\Gamma'}{\Delta'}{B}}
        \justifies
        \seqpt{
          \dtotimesr{\mathcal{D}}{\mathcal{D'}}{r}{A \otimes B}
        }{
          \fwdseq{\Gamma \cup \Gamma'}{\Delta, \Delta'}{A \otimes B}
        }
      \end{prooftree}
    \]

    By inductive hypothesis, we have

    \[
      \begin{array}{@{}c}
        \Gamma_n ; \Delta_n \vdash \tyj{M}{A} \\
        \Gamma'_n ; \Delta'_n \vdash \tyj{N}{B}
      \end{array}
    \]

    Let $C = \textsf{common}(\Gamma_n ; \Gamma'_n)$. Then, we have

    \[
      \begin{prooftree}
        \[
          \[
            \Gamma_n ; \Delta_n \vdash \tyj{M}{A}
            \justifies
            \Gamma_n, \Gamma'_n \setminus C_2 ; \Delta_n \vdash \tyj{M}{A}
            \using{weak}
          \]
          \qquad
          C
          \justifies
          \Gamma''_n ; \Delta_n \vdash \tyj{M'}{A}
          \using{apply_1}
        \]
        \[
          \[
            \Gamma'_n ; \Delta'_n \vdash \tyj{N}{B}
            \justifies
            \Gamma'_n, \Gamma_n \setminus C_1 ; \Delta'_n \vdash \tyj{N}{B}
          \]
          \qquad
          C
          \justifies
          \Gamma_n'' ; \Delta'_n \vdash \tyj{N'}{B}
        \]
        \justifies
        \Gamma''_n ; \Delta_n, \Delta'_n \vdash \tyj{\langle M',N' \rangle}{A
          \otimes B}
      \end{prooftree}
    \]

  \item Case $\otimes L$

    
    \[
      \begin{prooftree}
        \seqpt{
          \mathcal{D}
        }{
          \fwdseq{\Gamma}{\Delta, \labels{l_1^{k_1 + 1}}{A}, \labels{l_2^{k_2 +
                1}}{B}, \labels{l^k}{A \otimes B}}{C}
        }
        \justifies
        \seqpt{
          \dtotimesl{\mathcal{D}}{l_1}{A}{l_2}{B}{l}{A \otimes B}
        }{
          \fwdseq{\Gamma}{\Delta, l_1^{k_1}, l_2^{k_2}, l^{k+1}}{C}
        }
      \end{prooftree}
    \]

    By inductive hypothesis, we have $\Gamma_n ; \Delta_n, \tyj{u}{A},
    \tyj{v}{B} \vdash \tyj{N}{C}$. Then

    \[
      \begin{prooftree}
        \[
          \justifies
          \Gamma_n ; \tyj{w}{A \otimes B} \vdash \tyj{w}{A \otimes B}
          \using{hyp}
        \]
        \qquad
        \Gamma_n ; \Delta_n, \tyj{u}{A}, \tyj{v}{B} \vdash \tyj{N}{C}
        \justifies
        \Gamma_n ; \Delta_n, \tyj{w}{A \otimes B} \vdash \tyj{(\textsf{let
          }\langle u,v \rangle = w \textsf{ in } N)}{C}
        \using{\otimes E}
      \end{prooftree}
    \]

  \item Case $\limp R$.

    
    \[
      \begin{prooftree}
        \seqpt{\mathcal{D}}{\fwdseq{\Gamma}{\Delta, \labels{l^{k+1}}{A}}{B}}
        \justifies
        \seqpt{
          \dtlimpr{\mathcal{D}}{l}{A}{r}{A \limp B}
        }{
          \fwdseq{\Gamma}{\Delta, \labels{l^k}{A}}{\labels{r}{A \limp B}}
        }
      \end{prooftree}
    \]

    By inductive hypothesis, we have
    $\Gamma_n ; \Delta_n, \tyj{u}{A} \vdash \tyj{M}{B}$. Then,

    \[
      \begin{prooftree}
        \Gamma_n ; \Delta_n, \tyj{u}{A} \vdash \tyj{M}{B}
        \justifies
        \Gamma_n ; \Delta_n \vdash \tyj{\lambda u . M}{A \limp B}
        \using{\limp I}
      \end{prooftree}
    \]
    
  \item Case $\limp L$.
    
    \[
      \begin{prooftree}
        \seqpt{\mathcal{D}}{\fwdseq{\Gamma}{\Delta}{\labels{r}{A}}}
        \quad
        \seqpt{\mathcal{D'}}{\fwdseq{\Gamma'}{\Delta', \labels{l^{k_l+1}}{B}, \labels{s^{k_s}}{A
              \limp B}}{C}}
        \justifies
        \seqpt{
          \dtlimpl{\mathcal{D}}{\mathcal{D'}}{l}{B}{s}{A \limp B}
        }{
          \fwdseq{\Gamma \cup \Gamma'}{\Delta, \Delta',
            \labels{l^{k_l}}{B}, \labels{s^{k_s + 1}}{A \limp B}}{C}
        }
      \end{prooftree}
    \]

    By inductive hypothesis, we have

    \[
      \begin{array}{@{}c}
        \Gamma_n ; \Delta_n \vdash \tyj{M}{A} \\
        \Gamma'_n ; \Delta'_n, \tyj{u}{B} \vdash \tyj{N}{C}
      \end{array}
    \]

    therefore

    \[
      \begin{prooftree}
        \[
          \[
            \[
              \[
                \justifies
                \Gamma_n ; \tyj{w}{A \limp B} \vdash \tyj{w}{A \limp B}
              \]
              \qquad
              \Gamma_n ; \Delta_n \vdash \tyj{M}{A}
              \justifies
              \Gamma_n ; \Delta_n, \tyj{w}{A \limp B} \vdash \tyj{w M}{B}
            \]
            \justifies
            \Gamma_n, \Gamma'_n \setminus C_2 ; \Delta_n, \tyj{w}{A \limp B}
            \vdash\tyj{w M}{B}
            \using{weak}
          \]
          \qquad
          C
          \justifies
          \Gamma''_n ; \Delta_n, \tyj{w}{A \limp B} \vdash \tyj{w M}{B}
        \]
        \qquad
        \[
          \[
            \Gamma'_n ; \Delta'_n, \tyj{u}{B} \vdash \tyj{N}{C}
            \justifies
            \Gamma'_n, \Gamma_n \setminus C_1 ; \Delta'_n, \tyj{u}{B} \vdash \tyj{N}{C}
          \]
          \qquad
          C
          \justifies
          \Gamma''_n ; \Delta'_n, \tyj{u}{B} \vdash \tyj{N}{C}
        \]
        \justifies
        \Gamma''_n ; \Delta_n, \Delta'_n, \tyj{w}{A \limp B} \vdash
        \tyj{N[w M / u]}{C}
        \using{sost}
      \end{prooftree}
    \]
  \end{enumerate}
\end{proof}

Notice that the constructive proof of the theorem above automatically gives a
method to translate every labelled forward calculus derivation into a natural
deduction derivation.

\subsection{Derivation terms for forward labelled sequent calculus}

\[
  \begin{prooftree}
    \justifies
    \seqpt{\dtinit{p}}{\fwdseq{\cdot}{\labels{p}{p}}{p}}
  \end{prooftree}
\]

\[
  \begin{prooftree}
    \seqpt{\mathcal{D}}{
      \fwdseq{\Gamma}{\Delta, \labels{l^{k+1}}{A}}{C}}
    \justifies
    \seqpt{\dtcopy{\mathcal{D}}{l}{A}}{
      \fwdseq{\Gamma \cup \labels{l}{A}}{\Delta, \labels{l^k}{A}}{C}}
  \end{prooftree}
\]

\[
  \begin{prooftree}
    \seqpt{\mathcal{D}}{\fwdseq{\Gamma}{\Delta}{A}}
    \quad
    \seqpt{\mathcal{D'}}{\fwdseq{\Gamma'}{\Delta'}{B}}
    \justifies
    \seqpt{
      \dtotimesr{\mathcal{D}}{\mathcal{D'}}{r}{A \otimes B}
    }{
      \fwdseq{\Gamma \cup \Gamma'}{\Delta, \Delta'}{A \otimes B}
    }
  \end{prooftree}
\]

\[
  \begin{prooftree}
    \seqpt{
      \mathcal{D}
    }{
      \fwdseq{\Gamma}{\Delta, \labels{l_1^{k_1 + 1}}{A}, \labels{l_2^{k_2 +
            1}}{B}, \labels{l^k}{A \otimes B}}{C}
    }
    \justifies
    \seqpt{
      \dtotimesl{\mathcal{D}}{l_1}{A}{l_2}{B}{l}{A \otimes B}
    }{
      \fwdseq{\Gamma}{\Delta, l_1^{k_1}, l_2^{k_2}, l^{k+1}}{C}
    }
  \end{prooftree}
\]

\[
  \begin{prooftree}
    \seqpt{\mathcal{D}}{\fwdseq{\Gamma}{\Delta, \labels{l^{k+1}}{A}}{B}}
    \justifies
    \seqpt{
      \dtlimpr{\mathcal{D}}{l}{A}{r}{A \limp B}
    }{
      \fwdseq{\Gamma}{\Delta, \labels{l^k}{A}}{\labels{r}{A \limp B}}
    }
  \end{prooftree}
\]

\[
  \begin{prooftree}
    \seqpt{\mathcal{D}}{\fwdseq{\Gamma}{\Delta}{\labels{r}{A}}}
    \quad
    \seqpt{\mathcal{D'}}{\fwdseq{\Gamma'}{\Delta', \labels{l^{k_l+1}}{B}, \labels{s^{k_s}}{A
          \limp B}}{C}}
    \justifies
    \seqpt{
      \dtlimpl{\mathcal{D}}{\mathcal{D'}}{l}{B}{s}{A \limp B}
    }{
      \fwdseq{\Gamma \cup \Gamma'}{\Delta, \Delta',
        \labels{l^{k_l}}{B}, \labels{s^{k_s + 1}}{A \limp B}}{C}
    }
  \end{prooftree}
\]

\subsection{Derivation terms assignement for rule calculus}

The relations can be extended to relate not only premise sequents to conclusion
sequents, but also derivation terms of those premises to the corresponding
derivation term of the conclusion. The extension regarding derivation terms in
shown in Figure~\ref{fig:dertermrules}. We therefore consider relations of the
form $\relj{\frfrel{C}}{\seqpt{\mathcal{D}_1}{s_1} \cdots
  \seqpt{\mathcal{D}_n}{s_n}}{\seqpt{\mathcal{D}}{s}}$.

\begin{figure}[ht]
  \begin{mdframed}
    \[
      \begin{prooftree}
        p \; \text{left-biased}
        \justifies
        \relj{\frfrel{p}}{\cdot}{\dtinit{p}}
        \using{\linit}
      \end{prooftree}
      \qquad\qquad
      \begin{prooftree}
        p \; \text{right-based}
        \justifies
        \relj{\flfrel{p}}{\cdot}{\dtinit{p}}
        \using{\rinit}
      \end{prooftree}
    \]

    \[
      \begin{prooftree}
        \relj{\factrel{\btriseq{\cdot}{\cdot}{\cdot}{R}}}{\Sigma}{\mathcal{D}}
        \justifies
        \relj{\frfrel{R}}{\Sigma}{\mathcal{D}}
        \using{\faplus}
      \end{prooftree}
      \qquad \qquad
      \begin{prooftree}
        \relj{\factrel{\btriseq{\cdot}{\cdot}{L}{\cdot}}}{\Sigma}{\mathcal{D}}
        \justifies
        \relj{\flfrel{L}}{\Sigma}{\mathcal{D}}
        \using{\faminus}
      \end{prooftree}
    \]

    \[
      \begin{prooftree}
        p \text{ right-biased}
        \justifies
        \frfrelj{p}{\seqpt{\mathcal{D}}{s}}{\mathcal{D}}
        \using{conj^+}
      \end{prooftree}
    \]

    \[
      \begin{prooftree}
        p \text{ left-biased}
        \justifies
        \flfrelj{p}{\seqpt{\mathcal{D}}{s}}{\mathcal{D}}
        \using{conj^-}
      \end{prooftree}
    \]

    \[
      \begin{prooftree}
        \relj{\frfrel{A}}{\Sigma_2}{\mathcal{D}}
        \qquad
        \relj{\flfrel{\labels{l}{B}}}{\Sigma_1}{\mathcal{D'}}
        \justifies
        \relj{\flfrel{\labels{r}{A \limp B}}}{\Sigma_1 \cdot \Sigma_2}{
          \dtlimpl{\mathcal{D}}{\mathcal{D'}}{l}{B}{r}{A \limp B}
        }
        \using{\limp F}
      \end{prooftree}
    \]

    \[
      \begin{prooftree}
        \relj{\frfrel{A}}{\Sigma_1}{\mathcal{D}}
        \qquad
        \relj{\frfrel{B}}{\Sigma_2}{\mathcal{D'}}
        \justifies
        \relj{\frfrel{\labels{r}{A \otimes B}}}{\Sigma_1 \cdot \Sigma_2}{
          \dtotimesr{\mathcal{D}}{\mathcal{D'}}{r}{A \otimes B}
        }
        \using{\otimes F}
      \end{prooftree}
    \]

    \[
      \begin{prooftree}
        \relj{\factrel{\btriseq{\Gamma}{\Delta}{\Omega \cdot \labels{l}{A}}{B}}}{\Sigma}{\mathcal{D}}
        \justifies
        \relj{\factrel{\btriseq{\Gamma}{\Delta}{\Omega}{\labels{r}{A \limp
                B}}}}{\Sigma}{
          \dtlimpr{\mathcal{D}}{l}{A}{r}{A \limp B}
        }
        \using{\limp A}
      \end{prooftree}
    \]

    \[
      \begin{prooftree}
        \relj{\factrel{
            \btriseq{\Gamma}{\Delta}{\Omega \cdot \labels{l_A}{A} \cdot \labels{l_B}{B}}{\xi}}
        }{\Sigma}{\mathcal{D}}
        \justifies
        \relj{\factrel{
            \btriseq{\Gamma}{\Delta}{\Omega \cdot \labels{l}{A \otimes B}}{\xi}}
        }{\Sigma}{
          \dtotimesl{\mathcal{D}}{l_A}{A}{l_B}{B}{l}{A \otimes B}
        }
        \using{\otimes A}
      \end{prooftree}
    \]

    \[
      \begin{prooftree}
        \relj{\factrel{\btriseq{\Gamma}{\Delta, P}{\Omega}{\xi}}}{\Sigma}{\mathcal{D}}
        \justifies
        \relj{\factrel{\btriseq{\Gamma}{\Delta}{\Omega \cdot P}{\xi}}}{\Sigma}{\mathcal{D}}
        \using{\actrule}
      \end{prooftree}
    \]

    \[
      \begin{prooftree}
        \xi \subseteq \gamma
        \justifies
        \relj{
          \factrel{\btriseq{\Gamma}{\Delta}{\cdot}{\xi}}
        }{
          \seqpt{\mathcal{D}}{\fneuseq{\Gamma, \Gamma'}{\Delta, \Delta'}{\gamma}}
        }{
          \mathcal{D}
        }
        \using{\matchrule}
      \end{prooftree}
    \]
  \end{mdframed}
  \caption{Derivation term assignment for forward rule calculus}
  \label{fig:dertermrules}
\end{figure}

The derived rule for positive subformulas is:

\[
  \begin{prooftree}
    s_1 \quad \dots \quad s_n \quad
    (\relj{\frfrel{Q}}{s_1 \dots s_n}{
      \seqpt{\mathcal{D}}{\fneuseq{\Gamma}{\Delta}{\cdot}}
    })
    \justifies
    \seqpt{\mathcal{D}}{\fneuseq{\Gamma}{\Delta}{Q}}
    \using{\focplusrule}
  \end{prooftree}
\]

Similarly, for negative propositions, we have two rules:

\[
  \begin{prooftree}
    s_1 \quad \dots \quad s_n \quad
    (\relj{\flfrel{P}}{s_1 \dots s_n}{
      \seqpt{\mathcal{D}}{\fneuseq{\Gamma}{\Delta}{Q}}
    })
    \justifies
    \seqpt{\mathcal{D}}{\fneuseq{\Gamma}{\Delta, P}{Q}}
    \using{\focminusrule}
  \end{prooftree}
\]

\[
  \begin{prooftree}
    s_1 \quad \dots \quad s_n \quad
    (\relj{\flfrel{\labels{l}{A}}}{s_1 \dots s_n}{
      \seqpt{\mathcal{D}}{\fneuseq{\Gamma}{\Delta}{Q}}
    })
    \justifies
    \seqpt{\dtcopy{\mathcal{D}}{l}{A}}{\fneuseq{\Gamma, A}{\Delta}{Q}}
    \using{\foccopyrule}
  \end{prooftree}
\]

\end{document}
